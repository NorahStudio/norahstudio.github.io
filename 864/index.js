/*! For license information please see index.js.LICENSE.txt */
"use strict";(self.webpackChunkenjoy_life3000=self.webpackChunkenjoy_life3000||[]).push([[864,118],{6743:(t,e,n)=>{n.d(e,{Am:()=>T,FA:()=>w,I9:()=>b,Ku:()=>_,Uj:()=>o,XA:()=>c,ZQ:()=>h,eX:()=>y,g:()=>v,hp:()=>C,jZ:()=>l,lT:()=>g,lV:()=>f,nr:()=>p,sr:()=>d,tD:()=>S,u:()=>a,zW:()=>m});const s=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++s)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let e=0;e<t.length;e+=3){const r=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,u=a?t[e+2]:0,c=r>>2,h=(3&r)<<4|o>>4;let l=(15&o)<<2|u>>6,d=63&u;a||(d=64,i||(l=64)),s.push(n[c],n[h],n[l],n[d])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=t[n++];e[s++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[s++]=String.fromCharCode(55296+(i>>10)),e[s++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[s++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const r=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const u=e<t.length?n[t.charAt(e)]:64;if(++e,null==r||null==o||null==a||null==u)throw new i;const c=r<<2|o>>4;if(s.push(c),64!==a){const t=o<<4&240|a>>2;if(s.push(t),64!==u){const t=a<<6&192|u;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(t){return function(t){const e=s(t);return r.encodeByteArray(e,!0)}(t).replace(/\./g,"")},a=function(t){try{return r.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null},u=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&a(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},c=t=>{var e;return null===(e=u())||void 0===e?void 0:e[`_${t}`]};function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function l(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())}function d(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function f(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function g(){const t=h();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function p(){return!function(){var t;const e=null===(t=u())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function m(){try{return"object"==typeof indexedDB}catch(t){return!1}}function y(){return new Promise(((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var t;e((null===(t=r.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class v extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,w.prototype.create)}}class w{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],i=r?function(t,e){return t.replace(E,((t,n)=>{const s=e[n];return null!=s?String(s):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${i} (${s}).`;return new v(s,o,n)}}const E=/\{\$([^}]+)}/g;function T(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function b(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[n,s]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(s)}})),e}function C(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function S(t,e){const n=new A(t,e);return n.subscribe.bind(n)}class A{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,n){let s;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");s=function(t){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:n},void 0===s.next&&(s.next=I),void 0===s.error&&(s.error=I),void 0===s.complete&&(s.complete=I);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch(t){}})),this.observers.push(s),r}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function I(){}function _(t){return t&&t._delegate?t._delegate:t}},864:(t,e,n)=>{n.r(e),n.d(e,{useCollection:()=>nh,useCollectionData:()=>rh,useCollectionDataOnce:()=>ih,useCollectionOnce:()=>sh,useDocument:()=>uh,useDocumentData:()=>hh,useDocumentDataOnce:()=>lh,useDocumentOnce:()=>ch});var s,r=n(8461),i=n(5125),o=n(3424),a=n(6743),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},c={},h=h||{},l=u||self;function d(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function f(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),p=0;function m(t,e,n){return t.call.apply(t.bind,arguments)}function y(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function v(t,e,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?m:y).apply(null,arguments)}function w(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function E(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.prototype[n].apply(t,r)}}function T(){this.s=this.s,this.o=this.o}T.prototype.s=!1,T.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,g)&&t[g]||(t[g]=++p))},T.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const b=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function C(t){const e=t.length;if(0<e){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function S(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(d(n)){const e=t.length||0,s=n.length||0;t.length=e+s;for(let r=0;r<s;r++)t[e+r]=n[r]}else t.push(n)}}function A(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}A.prototype.h=function(){this.defaultPrevented=!0};var I=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",(()=>{}),e),l.removeEventListener("test",(()=>{}),e)}catch(t){}return t}();function _(t){return/^[\s\xa0]*$/.test(t)}function D(){var t=l.navigator;return t&&(t=t.userAgent)?t:""}function N(t){return-1!=D().indexOf(t)}function k(t){return k[" "](t),t}k[" "]=function(){};var x,R,O,L=N("Opera"),M=N("Trident")||N("MSIE"),F=N("Edge"),P=F||M,V=N("Gecko")&&!(-1!=D().toLowerCase().indexOf("webkit")&&!N("Edge"))&&!(N("Trident")||N("MSIE"))&&!N("Edge"),U=-1!=D().toLowerCase().indexOf("webkit")&&!N("Edge");function B(){var t=l.document;return t?t.documentMode:void 0}t:{var q="",j=(R=D(),V?/rv:([^\);]+)(\)|;)/.exec(R):F?/Edge\/([\d\.]+)/.exec(R):M?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(R):U?/WebKit\/(\S+)/.exec(R):L?/(?:Version)[ \/]?(\S+)/.exec(R):void 0);if(j&&(q=j?j[1]:""),M){var z=B();if(null!=z&&z>parseFloat(q)){x=String(z);break t}}x=q}l.document&&M?O=B()||parseInt(x,10)||void 0:O=void 0;var K=O;function $(t,e){if(A.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(V){t:{try{k(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:G[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&$.$.h.call(this)}}E($,A);var G={2:"touch",3:"pen",4:"mouse"};$.prototype.h=function(){$.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),H=0;function W(t,e,n,s,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.la=r,this.key=++H,this.fa=this.ia=!1}function X(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Y(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function J(t){const e={};for(const n in t)e[n]=t[n];return e}const Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t,e){let n,s;for(let e=1;e<arguments.length;e++){for(n in s=arguments[e],s)t[n]=s[n];for(let e=0;e<Z.length;e++)n=Z[e],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function et(t){this.src=t,this.g={},this.h=0}function nt(t,e){var n=e.type;if(n in t.g){var s,r=t.g[n],i=b(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(X(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function st(t,e,n,s){for(var r=0;r<t.length;++r){var i=t[r];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==s)return r}return-1}et.prototype.add=function(t,e,n,s,r){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=st(t,e,s,r);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new W(e,this.src,i,!!s,r)).ia=n,t.push(e)),e};var rt="closure_lm_"+(1e6*Math.random()|0),it={};function ot(t,e,n,s,r){if(s&&s.once)return ut(t,e,n,s,r);if(Array.isArray(e)){for(var i=0;i<e.length;i++)ot(t,e[i],n,s,r);return null}return n=pt(n),t&&t[Q]?t.O(e,n,f(s)?!!s.capture:!!s,r):at(t,e,n,!1,s,r)}function at(t,e,n,s,r,i){if(!e)throw Error("Invalid event type");var o=f(r)?!!r.capture:!!r,a=ft(t);if(a||(t[rt]=a=new et(t)),(n=a.add(e,n,s,o,i)).proxy)return n;if(s=function(){const t=dt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)I||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),s,r);else if(t.attachEvent)t.attachEvent(lt(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function ut(t,e,n,s,r){if(Array.isArray(e)){for(var i=0;i<e.length;i++)ut(t,e[i],n,s,r);return null}return n=pt(n),t&&t[Q]?t.P(e,n,f(s)?!!s.capture:!!s,r):at(t,e,n,!0,s,r)}function ct(t,e,n,s,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)ct(t,e[i],n,s,r);else s=f(s)?!!s.capture:!!s,n=pt(n),t&&t[Q]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=st(i=t.g[e],n,s,r))&&(X(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=ft(t))&&(e=t.g[e.toString()],t=-1,e&&(t=st(e,n,s,r)),(n=-1<t?e[t]:null)&&ht(n))}function ht(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Q])nt(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(lt(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=ft(e))?(nt(n,t),0==n.h&&(n.src=null,e[rt]=null)):X(t)}}}function lt(t){return t in it?it[t]:it[t]="on"+t}function dt(t,e){if(t.fa)t=!0;else{e=new $(e,this);var n=t.listener,s=t.la||t.src;t.ia&&ht(t),t=n.call(s,e)}return t}function ft(t){return(t=t[rt])instanceof et?t:null}var gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function pt(t){return"function"==typeof t?t:(t[gt]||(t[gt]=function(e){return t.handleEvent(e)}),t[gt])}function mt(){T.call(this),this.i=new et(this),this.S=this,this.J=null}function yt(t,e){var n,s=t.J;if(s)for(n=[];s;s=s.J)n.push(s);if(t=t.S,s=e.type||e,"string"==typeof e)e=new A(e,t);else if(e instanceof A)e.target=e.target||t;else{var r=e;tt(e=new A(s,t),r)}if(r=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];r=vt(o,s,!0,e)&&r}if(r=vt(o=e.g=t,s,!0,e)&&r,r=vt(o,s,!1,e)&&r,n)for(i=0;i<n.length;i++)r=vt(o=e.g=n[i],s,!1,e)&&r}function vt(t,e,n,s){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,u=o.la||o.src;o.ia&&nt(t.i,o),r=!1!==a.call(u,s)&&r}}return r&&!s.defaultPrevented}E(mt,T),mt.prototype[Q]=!0,mt.prototype.removeEventListener=function(t,e,n,s){ct(this,t,e,n,s)},mt.prototype.N=function(){if(mt.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],s=0;s<n.length;s++)X(n[s]);delete e.g[t],e.h--}}this.J=null},mt.prototype.O=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)},mt.prototype.P=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};var wt=l.JSON.stringify;function Et(){var t=_t;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Tt=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new bt),(t=>t.reset()));class bt{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Ct(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function St(t){l.setTimeout((()=>{throw t}),0)}let At,It=!1,_t=new class{constructor(){this.h=this.g=null}add(t,e){const n=Tt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Dt=()=>{const t=l.Promise.resolve(void 0);At=()=>{t.then(Nt)}};var Nt=()=>{for(var t;t=Et();){try{t.h.call(t.g)}catch(t){St(t)}var e=Tt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}It=!1};function kt(t,e){mt.call(this),this.h=t||1,this.g=e||l,this.j=v(this.qb,this),this.l=Date.now()}function xt(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Rt(t,e,n){if("function"==typeof t)n&&(t=v(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=v(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function Ot(t){t.g=Rt((()=>{t.g=null,t.i&&(t.i=!1,Ot(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}E(kt,mt),(s=kt.prototype).ga=!1,s.T=null,s.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),yt(this,"tick"),this.ga&&(xt(this),this.start()))}},s.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},s.N=function(){kt.$.N.call(this),xt(this),delete this.g};class Lt extends T{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Ot(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mt(t){T.call(this),this.h=t,this.g={}}E(Mt,T);var Ft=[];function Pt(t,e,n,s){Array.isArray(n)||(n&&(Ft[0]=n.toString()),n=Ft);for(var r=0;r<n.length;r++){var i=ot(e,n[r],s||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function Vt(t){Y(t.g,(function(t,e){this.g.hasOwnProperty(e)&&ht(t)}),t),t.g={}}function Ut(){this.g=!0}function Bt(t,e,n,s){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<r.length;o++)r[o]=""}}}return wt(n)}catch(t){return e}}(t,n)+(s?" "+s:"")}))}Mt.prototype.N=function(){Mt.$.N.call(this),Vt(this)},Mt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ut.prototype.Ea=function(){this.g=!1},Ut.prototype.info=function(){};var qt={},jt=null;function zt(){return jt=jt||new mt}function Kt(t){A.call(this,qt.Ta,t)}function $t(t){const e=zt();yt(e,new Kt(e))}function Gt(t,e){A.call(this,qt.STAT_EVENT,t),this.stat=e}function Qt(t){const e=zt();yt(e,new Gt(e,t))}function Ht(t,e){A.call(this,qt.Ua,t),this.size=e}function Wt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){t()}),e)}qt.Ta="serverreachability",E(Kt,A),qt.STAT_EVENT="statevent",E(Gt,A),qt.Ua="timingevent",E(Ht,A);var Xt={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Yt={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Jt(){}function Zt(t){return t.h||(t.h=t.i())}function te(){}Jt.prototype.h=null;var ee,ne={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function se(){A.call(this,"d")}function re(){A.call(this,"c")}function ie(){}function oe(t,e,n,s){this.l=t,this.j=e,this.m=n,this.W=s||1,this.U=new Mt(this),this.P=ue,t=P?125:void 0,this.V=new kt(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ae}function ae(){this.i=null,this.g="",this.h=!1}E(se,A),E(re,A),E(ie,Jt),ie.prototype.g=function(){return new XMLHttpRequest},ie.prototype.i=function(){return{}},ee=new ie;var ue=45e3,ce={},he={};function le(t,e,n){t.L=1,t.v=ke(Ae(e)),t.s=n,t.S=!0,de(t,null)}function de(t,e){t.G=Date.now(),me(t),t.A=Ae(t.v);var n=t.A,s=t.W;Array.isArray(s)||(s=[String(s)]),ze(n.i,"t",s),t.C=0,n=t.l.J,t.h=new ae,t.g=Kn(t.l,n?e:null,!t.s),0<t.O&&(t.M=new Lt(v(t.Pa,t,t.g),t.O)),Pt(t.U,t.g,"readystatechange",t.nb),e=t.I?J(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),$t(),function(t,e,n,s,r,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+c+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function fe(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.l.Ha}function ge(t,e,n){let s,r=!0;for(;!t.J&&t.C<n.length;){if(s=pe(t,n),s==he){4==e&&(t.o=4,Qt(14),r=!1),Bt(t.j,t.m,null,"[Incomplete Response]");break}if(s==ce){t.o=4,Qt(15),Bt(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}Bt(t.j,t.m,s,null),Te(t,s)}fe(t)&&s!=he&&s!=ce&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Qt(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Fn(e),e.M=!0,Qt(11))):(Bt(t.j,t.m,n,"[Invalid Chunked Response]"),Ee(t),we(t))}function pe(t,e){var n=t.C,s=e.indexOf("\n",n);return-1==s?he:(n=Number(e.substring(n,s)),isNaN(n)?ce:(s+=1)+n>e.length?he:(e=e.slice(s,s+n),t.C=s+n,e))}function me(t){t.Y=Date.now()+t.P,ye(t,t.P)}function ye(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Wt(v(t.lb,t),e)}function ve(t){t.B&&(l.clearTimeout(t.B),t.B=null)}function we(t){0==t.l.H||t.J||Un(t.l,t)}function Ee(t){ve(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,xt(t.V),Vt(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Te(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Xe(n.i,t)))if(!t.K&&Xe(n.i,t)&&3==n.H){try{var s=n.Ja.g.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Vn(n),Dn(n)}Mn(n),Qt(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&0==n.A&&!n.v&&(n.v=Wt(v(n.ib,n),6e3));if(1>=We(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else qn(n,11)}else if((t.K||n.g==t)&&Vn(n),!_(e))for(r=n.Ja.g.parse(e),e=0;e<r.length;e++){let c=r[e];if(n.V=c[0],c=c[1],2==n.H)if("c"==c[0]){n.K=c[1],n.pa=c[2];const e=c[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const r=c[4];null!=r&&(n.Ga=r,n.l.info("SVER="+n.Ga));const h=c[5];null!=h&&"number"==typeof h&&0<h&&(s=1.5*h,n.L=s,n.l.info("backChannelRequestTimeoutMs_="+s)),s=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=s.i;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Ye(i,i.h),i.h=null))}if(s.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(s.Da=t,Ne(s.I,s.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((s=n).wa=zn(s,s.J?s.pa:null,s.Y),o.K){Je(s.i,o);var a=o,u=s.L;u&&a.setTimeout(u),a.B&&(ve(a),me(a)),s.g=o}else Ln(s);0<n.j.length&&kn(n)}else"stop"!=c[0]&&"close"!=c[0]||qn(n,7);else 3==n.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?qn(n,7):_n(n):"noop"!=c[0]&&n.h&&n.h.Aa(c),n.A=0)}$t()}catch(t){}}function be(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(d(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const s in t)e[n++]=s;return e}}}(t),s=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(d(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t),r=s.length,i=0;i<r;i++)e.call(void 0,s[i],n&&n[i],t)}(s=oe.prototype).setTimeout=function(t){this.P=t},s.nb=function(t){t=t.target;const e=this.M;e&&3==Tn(t)?e.l():this.Pa(t)},s.Pa=function(t){try{if(t==this.g)t:{const h=Tn(this.g);var e=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||P||this.g&&(this.h.h||this.g.ja()||bn(this.g)))){this.J||4!=h||7==e||$t(),ve(this);var n=this.g.da();this.ca=n;e:if(fe(this)){var s=bn(this.g);t="";var r=s.length,i=4==Tn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ee(this),we(this);var o="";break e}this.h.i=new l.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:i&&e==r-1});s.splice(0,r),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,s,r,i,o){t.info((function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(a)){var c=a;break e}}c=null}if(!(n=c)){this.i=!1,this.o=3,Qt(12),Ee(this),we(this);break t}Bt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Te(this,n)}this.S?(ge(this,h,o),P&&this.i&&3==h&&(Pt(this.U,this.V,"tick",this.mb),this.V.start())):(Bt(this.j,this.m,o,null),Te(this,o)),4==h&&Ee(this),this.i&&!this.J&&(4==h?Un(this.l,this):(this.i=!1,me(this)))}else(function(t){const e={};t=(t.g&&2<=Tn(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<t.length;s++){if(_(t[s]))continue;var n=Ct(t[s]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[r]||[];e[r]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Qt(12)):(this.o=0,Qt(13)),Ee(this),we(this)}}}catch(t){}},s.mb=function(){if(this.g){var t=Tn(this.g),e=this.g.ja();this.C<e.length&&(ve(this),ge(this,t,e),this.i&&4!=t&&me(this))}},s.cancel=function(){this.J=!0,Ee(this)},s.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&($t(),Qt(17)),Ee(this),this.o=2,we(this)):ye(this,this.Y-t)};var Ce=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Se(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Se){this.h=t.h,Ie(this,t.j),this.s=t.s,this.g=t.g,_e(this,t.m),this.l=t.l;var e=t.i,n=new Ue;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),De(this,n),this.o=t.o}else t&&(e=String(t).match(Ce))?(this.h=!1,Ie(this,e[1]||"",!0),this.s=xe(e[2]||""),this.g=xe(e[3]||"",!0),_e(this,e[4]),this.l=xe(e[5]||"",!0),De(this,e[6]||"",!0),this.o=xe(e[7]||"")):(this.h=!1,this.i=new Ue(null,this.h))}function Ae(t){return new Se(t)}function Ie(t,e,n){t.j=n?xe(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function _e(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function De(t,e,n){e instanceof Ue?(t.i=e,function(t,e){e&&!t.j&&(Be(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(qe(this,e),ze(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Re(e,Pe)),t.i=new Ue(e,t.h))}function Ne(t,e,n){t.i.set(e,n)}function ke(t){return Ne(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function xe(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Re(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Oe),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Oe(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Se.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Re(e,Le,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Re(e,Le,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Re(n,"/"==n.charAt(0)?Fe:Me,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Re(n,Ve)),t.join("")};var Le=/[#\/\?@]/g,Me=/[#\?:]/g,Fe=/[#\?]/g,Pe=/[#\?@]/g,Ve=/#/g;function Ue(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Be(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),r=null;if(0<=s){var i=t[n].substring(0,s);r=t[n].substring(s+1)}else i=t[n];e(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function qe(t,e){Be(t),e=Ke(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function je(t,e){return Be(t),e=Ke(t,e),t.g.has(e)}function ze(t,e,n){qe(t,e),0<n.length&&(t.i=null,t.g.set(Ke(t,e),C(n)),t.h+=n.length)}function Ke(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(s=Ue.prototype).add=function(t,e){Be(this),this.i=null,t=Ke(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},s.forEach=function(t,e){Be(this),this.g.forEach((function(n,s){n.forEach((function(n){t.call(e,n,s,this)}),this)}),this)},s.ta=function(){Be(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let s=0;s<e.length;s++){const r=t[s];for(let t=0;t<r.length;t++)n.push(e[s])}return n},s.Z=function(t){Be(this);let e=[];if("string"==typeof t)je(this,t)&&(e=e.concat(this.g.get(Ke(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},s.set=function(t,e){return Be(this),this.i=null,je(this,t=Ke(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},s.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var s=e[n];const i=encodeURIComponent(String(s)),o=this.Z(s);for(s=0;s<o.length;s++){var r=i;""!==o[s]&&(r+="="+encodeURIComponent(String(o[s]))),t.push(r)}}return this.i=t.join("&")};var $e=class{constructor(t,e){this.g=t,this.map=e}};function Ge(t){this.l=t||Qe,t=l.PerformanceNavigationTiming?0<(t=l.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(l.g&&l.g.Ka&&l.g.Ka()&&l.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Qe=10;function He(t){return!!t.h||!!t.g&&t.g.size>=t.j}function We(t){return t.h?1:t.g?t.g.size:0}function Xe(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Ye(t,e){t.g?t.g.add(e):t.h=e}function Je(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Ze(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return C(t.i)}Ge.prototype.cancel=function(){if(this.i=Ze(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var tn=class{stringify(t){return l.JSON.stringify(t,void 0)}parse(t){return l.JSON.parse(t,void 0)}};function en(){this.g=new tn}function nn(t,e,n){const s=n||"";try{be(t,(function(t,n){let r=t;f(t)&&(r=wt(t)),e.push(s+n+"="+encodeURIComponent(r))}))}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function sn(t,e,n,s,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(s)}catch(t){}}function rn(t){this.l=t.fc||null,this.j=t.ob||!1}function on(t,e){mt.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=an,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}E(rn,Jt),rn.prototype.g=function(){return new on(this.l,this.j)},rn.prototype.i=function(t){return function(){return t}}({}),E(on,mt);var an=0;function un(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function cn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,hn(t)}function hn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(s=on.prototype).open=function(t,e){if(this.readyState!=an)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,hn(this)},s.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||l).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},s.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,cn(this)),this.readyState=an},s.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,hn(this)),this.g&&(this.readyState=3,hn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==l.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;un(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},s.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?cn(this):hn(this),3==this.readyState&&un(this)}},s.Za=function(t){this.g&&(this.response=this.responseText=t,cn(this))},s.Ya=function(t){this.g&&(this.response=t,cn(this))},s.ka=function(){this.g&&cn(this)},s.setRequestHeader=function(t,e){this.v.append(t,e)},s.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(on.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var ln=l.JSON.parse;function dn(t){mt.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=fn,this.L=this.M=!1}E(dn,mt);var fn="",gn=/^https?$/i,pn=["POST","PUT"];function mn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,yn(t),wn(t)}function yn(t){t.F||(t.F=!0,yt(t,"complete"),yt(t,"error"))}function vn(t){if(t.h&&void 0!==h&&(!t.C[1]||4!=Tn(t)||2!=t.da()))if(t.v&&4==Tn(t))Rt(t.La,0,t);else if(yt(t,"readystatechange"),4==Tn(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===o){var r=String(t.I).match(Ce)[1]||null;!r&&l.self&&l.self.location&&(r=l.self.location.protocol.slice(0,-1)),s=!gn.test(r?r.toLowerCase():"")}n=s}if(n)yt(t,"complete"),yt(t,"success");else{t.m=6;try{var i=2<Tn(t)?t.g.statusText:""}catch(t){i=""}t.j=i+" ["+t.da()+"]",yn(t)}}finally{wn(t)}}}function wn(t,e){if(t.g){En(t);const n=t.g,s=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||yt(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function En(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(l.clearTimeout(t.A),t.A=null)}function Tn(t){return t.g?t.g.readyState:0}function bn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case fn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Cn(t){let e="";return Y(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Sn(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=Cn(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ne(t,e,n))}function An(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function In(t){this.Ga=0,this.j=[],this.l=new Ut,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=An("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=An("baseRetryDelayMs",5e3,t),this.hb=An("retryDelaySeedMs",1e4,t),this.eb=An("forwardChannelMaxRetries",2,t),this.xa=An("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Ge(t&&t.concurrentRequestLimit),this.Ja=new en,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function _n(t){if(Nn(t),3==t.H){var e=t.W++,n=Ae(t.I);if(Ne(n,"SID",t.K),Ne(n,"RID",e),Ne(n,"TYPE","terminate"),Rn(t,n),(e=new oe(t,t.l,e)).L=2,e.v=ke(Ae(n)),n=!1,l.navigator&&l.navigator.sendBeacon)try{n=l.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&l.Image&&((new Image).src=e.v,n=!0),n||(e.g=Kn(e.l,null),e.g.ha(e.v)),e.G=Date.now(),me(e)}jn(t)}function Dn(t){t.g&&(Fn(t),t.g.cancel(),t.g=null)}function Nn(t){Dn(t),t.u&&(l.clearTimeout(t.u),t.u=null),Vn(t),t.i.cancel(),t.m&&("number"==typeof t.m&&l.clearTimeout(t.m),t.m=null)}function kn(t){if(!He(t.i)&&!t.m){t.m=!0;var e=t.Na;At||Dt(),It||(At(),It=!0),_t.add(e,t),t.C=0}}function xn(t,e){var n;n=e?e.m:t.W++;const s=Ae(t.I);Ne(s,"SID",t.K),Ne(s,"RID",n),Ne(s,"AID",t.V),Rn(t,s),t.o&&t.s&&Sn(s,t.o,t.s),n=new oe(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=On(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Ye(t.i,n),le(n,s,e)}function Rn(t,e){t.na&&Y(t.na,(function(t,n){Ne(e,n,t)})),t.h&&be({},(function(t,n){Ne(e,n,t)}))}function On(t,e,n){n=Math.min(t.j.length,n);var s=t.h?v(t.h.Va,t.h,t):null;t:{var r=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=r[o].g;const a=r[o].map;if(n-=e,0>n)e=Math.max(0,r[o].g-100),i=!1;else try{nn(a,t,"req"+n+"_")}catch(t){s&&s(a)}}if(i){s=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,s}function Ln(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;At||Dt(),It||(At(),It=!0),_t.add(e,t),t.A=0}}function Mn(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=Wt(v(t.Ma,t),Bn(t,t.A)),t.A++,0))}function Fn(t){null!=t.B&&(l.clearTimeout(t.B),t.B=null)}function Pn(t){t.g=new oe(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Ae(t.wa);Ne(e,"RID","rpc"),Ne(e,"SID",t.K),Ne(e,"AID",t.V),Ne(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Ne(e,"TO",t.qa),Ne(e,"TYPE","xmlhttp"),Rn(t,e),t.o&&t.s&&Sn(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=ke(Ae(e)),n.s=null,n.S=!0,de(n,t)}function Vn(t){null!=t.v&&(l.clearTimeout(t.v),t.v=null)}function Un(t,e){var n=null;if(t.g==e){Vn(t),Fn(t),t.g=null;var s=2}else{if(!Xe(t.i,e))return;n=e.F,Je(t.i,e),s=1}if(0!=t.H)if(e.i)if(1==s){n=e.s?e.s.length:0,e=Date.now()-e.G;var r=t.C;yt(s=zt(),new Ht(s,n)),kn(t)}else Ln(t);else if(3==(r=e.o)||0==r&&0<e.ca||!(1==s&&function(t,e){return!(We(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Wt(v(t.Na,t,e),Bn(t,t.C)),t.C++,0)))}(t,e)||2==s&&Mn(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),r){case 1:qn(t,5);break;case 4:qn(t,10);break;case 3:qn(t,6);break;default:qn(t,2)}}function Bn(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function qn(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var s=v(t.pb,t);n||(n=new Se("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Ie(n,"https"),ke(n)),function(t,e){const n=new Ut;if(l.Image){const s=new Image;s.onload=w(sn,n,s,"TestLoadImage: loaded",!0,e),s.onerror=w(sn,n,s,"TestLoadImage: error",!1,e),s.onabort=w(sn,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=w(sn,n,s,"TestLoadImage: timeout",!1,e),l.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=t}else e(!1)}(n.toString(),s)}else Qt(2);t.H=0,t.h&&t.h.za(e),jn(t),Nn(t)}function jn(t){if(t.H=0,t.ma=[],t.h){const e=Ze(t.i);0==e.length&&0==t.j.length||(S(t.ma,e),S(t.ma,t.j),t.i.i.length=0,C(t.j),t.j.length=0),t.h.ya()}}function zn(t,e,n){var s=n instanceof Se?Ae(n):new Se(n);if(""!=s.g)e&&(s.g=e+"."+s.g),_e(s,s.m);else{var r=l.location;s=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var i=new Se(null);s&&Ie(i,s),e&&(i.g=e),r&&_e(i,r),n&&(i.l=n),s=i}return n=t.F,e=t.Da,n&&e&&Ne(s,n,e),Ne(s,"VER",t.ra),Rn(t,s),s}function Kn(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ha&&!t.va?new dn(new rn({ob:!0})):new dn(t.va)).Oa(t.J),e}function $n(){}function Gn(){if(M&&!(10<=Number(K)))throw Error("Environmental error: no available transport.")}function Qn(t,e){mt.call(this),this.g=new In(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!_(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!_(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Xn(this)}function Hn(t){se.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Wn(){re.call(this),this.status=1}function Xn(t){this.g=t}function Yn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Jn(t,e,n){n||(n=0);var s=Array(16);if("string"==typeof e)for(var r=0;16>r;++r)s[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;16>r;++r)s[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];var i=t.g[3],o=e+(i^n&(r^i))+s[0]+3614090360&4294967295;o=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=(n=(r=(i=(e=n+(o<<7&4294967295|o>>>25))+((o=i+(r^e&(n^r))+s[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(e^n))+s[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(i^e))+s[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(r^i))+s[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^e&(n^r))+s[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(e^n))+s[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(i^e))+s[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(r^i))+s[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^e&(n^r))+s[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(e^n))+s[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(i^e))+s[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(r^i))+s[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^e&(n^r))+s[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(e^n))+s[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(i^e))+s[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^i&(n^r))+s[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(e^n))+s[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(i^e))+s[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(r^i))+s[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^i&(n^r))+s[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(e^n))+s[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(i^e))+s[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(r^i))+s[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^i&(n^r))+s[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(e^n))+s[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(i^e))+s[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(r^i))+s[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^i&(n^r))+s[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(e^n))+s[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(i^e))+s[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(r^i))+s[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^r^i)+s[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^r)+s[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^e^n)+s[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^e)+s[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^i)+s[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^r)+s[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^e^n)+s[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^e)+s[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^i)+s[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^r)+s[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^e^n)+s[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^e)+s[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^i)+s[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^r)+s[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^e^n)+s[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^e)+s[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(r^(n|~i))+s[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~r))+s[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(i|~n))+s[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(r|~e))+s[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~i))+s[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~r))+s[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(i|~n))+s[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(r|~e))+s[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~i))+s[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~r))+s[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(i|~n))+s[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(r|~e))+s[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=n+((o=e+(r^(n|~i))+s[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~r))+s[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=i+((o=r+(e^(i|~n))+s[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+s[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+i&4294967295}function Zn(t,e){this.h=e;for(var n=[],s=!0,r=t.length-1;0<=r;r--){var i=0|t[r];s&&i==e||(n[r]=i,s=!1)}this.g=n}(s=dn.prototype).Oa=function(t){this.M=t},s.ha=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ee.g(),this.C=this.u?Zt(this.u):Zt(ee),this.g.onreadystatechange=v(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void mn(this,t)}if(t=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const t of s.keys())n.set(t,s.get(t))}s=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),r=l.FormData&&t instanceof l.FormData,!(0<=b(pn,e))||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{En(this),0<this.B&&((this.L=function(t){return M&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=v(this.ua,this)):this.A=Rt(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){mn(this,t)}},s.ua=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,yt(this,"timeout"),this.abort(8))},s.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,yt(this,"complete"),yt(this,"abort"),wn(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),wn(this,!0)),dn.$.N.call(this)},s.La=function(){this.s||(this.G||this.v||this.l?vn(this):this.kb())},s.kb=function(){vn(this)},s.isActive=function(){return!!this.g},s.da=function(){try{return 2<Tn(this)?this.g.status:-1}catch(t){return-1}},s.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},s.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ln(e)}},s.Ia=function(){return this.m},s.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(s=In.prototype).ra=8,s.H=1,s.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new oe(this,this.l,t);let i=this.s;if(this.U&&(i?(i=J(i),tt(i,this.U)):i=this.U),null!==this.o||this.O||(r.I=i,i=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var s=this.j[n];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=On(this,r,e),Ne(n=Ae(this.I),"RID",t),Ne(n,"CVER",22),this.F&&Ne(n,"X-HTTP-Session-Id",this.F),Rn(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(Cn(i)))+"&"+e:this.o&&Sn(n,this.o,i)),Ye(this.i,r),this.bb&&Ne(n,"TYPE","init"),this.P?(Ne(n,"$req",e),Ne(n,"SID","null"),r.aa=!0,le(r,n,null)):le(r,n,e),this.H=2}}else 3==this.H&&(t?xn(this,t):0==this.j.length||He(this.i)||xn(this))},s.Ma=function(){if(this.u=null,Pn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Wt(v(this.jb,this),t)}},s.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Qt(10),Dn(this),Pn(this))},s.ib=function(){null!=this.v&&(this.v=null,Dn(this),Mn(this),Qt(19))},s.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Qt(2)):(this.l.info("Failed to ping google.com"),Qt(1))},s.isActive=function(){return!!this.h&&this.h.isActive(this)},(s=$n.prototype).Ba=function(){},s.Aa=function(){},s.za=function(){},s.ya=function(){},s.isActive=function(){return!0},s.Va=function(){},Gn.prototype.g=function(t,e){return new Qn(t,e)},E(Qn,mt),Qn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Qt(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=zn(t,null,t.Y),kn(t)},Qn.prototype.close=function(){_n(this.g)},Qn.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=wt(t),t=n);e.j.push(new $e(e.fb++,t)),3==e.H&&kn(e)},Qn.prototype.N=function(){this.g.h=null,delete this.j,_n(this.g),delete this.g,Qn.$.N.call(this)},E(Hn,se),E(Wn,re),E(Xn,$n),Xn.prototype.Ba=function(){yt(this.g,"a")},Xn.prototype.Aa=function(t){yt(this.g,new Hn(t))},Xn.prototype.za=function(t){yt(this.g,new Wn)},Xn.prototype.ya=function(){yt(this.g,"b")},E(Yn,(function(){this.blockSize=-1})),Yn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Yn.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,s=this.m,r=this.h,i=0;i<e;){if(0==r)for(;i<=n;)Jn(this,t,i),i+=this.blockSize;if("string"==typeof t){for(;i<e;)if(s[r++]=t.charCodeAt(i++),r==this.blockSize){Jn(this,s),r=0;break}}else for(;i<e;)if(s[r++]=t[i++],r==this.blockSize){Jn(this,s),r=0;break}}this.h=r,this.i+=e},Yn.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var s=0;32>s;s+=8)t[n++]=this.g[e]>>>s&255;return t};var ts={};function es(t){return-128<=t&&128>t?function(t){var e=ts;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new Zn([0|t],0>t?-1:0)}(t)}(t):new Zn([0|t],0>t?-1:0)}function ns(t){if(isNaN(t)||!isFinite(t))return rs;if(0>t)return cs(ns(-t));for(var e=[],n=1,s=0;t>=n;s++)e[s]=t/n|0,n*=ss;return new Zn(e,0)}var ss=4294967296,rs=es(0),is=es(1),os=es(16777216);function as(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function us(t){return-1==t.h}function cs(t){for(var e=t.g.length,n=[],s=0;s<e;s++)n[s]=~t.g[s];return new Zn(n,~t.h).add(is)}function hs(t,e){return t.add(cs(e))}function ls(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function ds(t,e){this.g=t,this.h=e}function fs(t,e){if(as(e))throw Error("division by zero");if(as(t))return new ds(rs,rs);if(us(t))return e=fs(cs(t),e),new ds(cs(e.g),cs(e.h));if(us(e))return e=fs(t,cs(e)),new ds(cs(e.g),e.h);if(30<t.g.length){if(us(t)||us(e))throw Error("slowDivide_ only works with positive integers.");for(var n=is,s=e;0>=s.X(t);)n=gs(n),s=gs(s);var r=ps(n,1),i=ps(s,1);for(s=ps(s,2),n=ps(n,2);!as(s);){var o=i.add(s);0>=o.X(t)&&(r=r.add(n),i=o),s=ps(s,1),n=ps(n,1)}return e=hs(t,r.R(e)),new ds(r,e)}for(r=rs;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),s=48>=(s=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,s-48),o=(i=ns(n)).R(e);us(o)||0<o.X(t);)o=(i=ns(n-=s)).R(e);as(i)&&(i=is),r=r.add(i),t=hs(t,o)}return new ds(r,t)}function gs(t){for(var e=t.g.length+1,n=[],s=0;s<e;s++)n[s]=t.D(s)<<1|t.D(s-1)>>>31;return new Zn(n,t.h)}function ps(t,e){var n=e>>5;e%=32;for(var s=t.g.length-n,r=[],i=0;i<s;i++)r[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new Zn(r,t.h)}(s=Zn.prototype).ea=function(){if(us(this))return-cs(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var s=this.D(n);t+=(0<=s?s:ss+s)*e,e*=ss}return t},s.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(as(this))return"0";if(us(this))return"-"+cs(this).toString(t);for(var e=ns(Math.pow(t,6)),n=this,s="";;){var r=fs(n,e).g,i=((0<(n=hs(n,r.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(as(n=r))return i+s;for(;6>i.length;)i="0"+i;s=i+s}},s.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},s.X=function(t){return us(t=hs(this,t))?-1:as(t)?0:1},s.abs=function(){return us(this)?cs(this):this},s.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0,r=0;r<=e;r++){var i=s+(65535&this.D(r))+(65535&t.D(r)),o=(i>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);s=o>>>16,i&=65535,o&=65535,n[r]=o<<16|i}return new Zn(n,-2147483648&n[n.length-1]?-1:0)},s.R=function(t){if(as(this)||as(t))return rs;if(us(this))return us(t)?cs(this).R(cs(t)):cs(cs(this).R(t));if(us(t))return cs(this.R(cs(t)));if(0>this.X(os)&&0>t.X(os))return ns(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],s=0;s<2*e;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var r=0;r<t.g.length;r++){var i=this.D(s)>>>16,o=65535&this.D(s),a=t.D(r)>>>16,u=65535&t.D(r);n[2*s+2*r]+=o*u,ls(n,2*s+2*r),n[2*s+2*r+1]+=i*u,ls(n,2*s+2*r+1),n[2*s+2*r+1]+=o*a,ls(n,2*s+2*r+1),n[2*s+2*r+2]+=i*a,ls(n,2*s+2*r+2)}for(s=0;s<e;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=e;s<2*e;s++)n[s]=0;return new Zn(n,0)},s.gb=function(t){return fs(this,t).h},s.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)&t.D(s);return new Zn(n,this.h&t.h)},s.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)|t.D(s);return new Zn(n,this.h|t.h)},s.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)^t.D(s);return new Zn(n,this.h^t.h)},Gn.prototype.createWebChannel=Gn.prototype.g,Qn.prototype.send=Qn.prototype.u,Qn.prototype.open=Qn.prototype.m,Qn.prototype.close=Qn.prototype.close,Xt.NO_ERROR=0,Xt.TIMEOUT=8,Xt.HTTP_ERROR=6,Yt.COMPLETE="complete",te.EventType=ne,ne.OPEN="a",ne.CLOSE="b",ne.ERROR="c",ne.MESSAGE="d",mt.prototype.listen=mt.prototype.O,dn.prototype.listenOnce=dn.prototype.P,dn.prototype.getLastError=dn.prototype.Sa,dn.prototype.getLastErrorCode=dn.prototype.Ia,dn.prototype.getStatus=dn.prototype.da,dn.prototype.getResponseJson=dn.prototype.Wa,dn.prototype.getResponseText=dn.prototype.ja,dn.prototype.send=dn.prototype.ha,dn.prototype.setWithCredentials=dn.prototype.Oa,Yn.prototype.digest=Yn.prototype.l,Yn.prototype.reset=Yn.prototype.reset,Yn.prototype.update=Yn.prototype.j,Zn.prototype.add=Zn.prototype.add,Zn.prototype.multiply=Zn.prototype.R,Zn.prototype.modulo=Zn.prototype.gb,Zn.prototype.compare=Zn.prototype.X,Zn.prototype.toNumber=Zn.prototype.ea,Zn.prototype.toString=Zn.prototype.toString,Zn.prototype.getBits=Zn.prototype.D,Zn.fromNumber=ns,Zn.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return cs(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var s=ns(Math.pow(n,8)),r=rs,i=0;i<e.length;i+=8){var o=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+o),n);8>o?(o=ns(Math.pow(n,o)),r=r.R(o).add(ns(a))):r=(r=r.R(s)).add(ns(a))}return r};var ms=c.createWebChannelTransport=function(){return new Gn},ys=c.getStatEventTarget=function(){return zt()},vs=c.ErrorCode=Xt,ws=c.EventType=Yt,Es=c.Event=qt,Ts=c.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},bs=c.FetchXmlHttpFactory=rn,Cs=c.WebChannel=te,Ss=c.XhrIo=dn,As=c.Md5=Yn,Is=c.Integer=Zn;const _s="@firebase/firestore";class Ds{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ds.UNAUTHENTICATED=new Ds(null),Ds.GOOGLE_CREDENTIALS=new Ds("google-credentials-uid"),Ds.FIRST_PARTY=new Ds("first-party-uid"),Ds.MOCK_USER=new Ds("mock-user");let Ns="9.23.0";const ks=new o.Vy("@firebase/firestore");function xs(){return ks.logLevel}function Rs(t,...e){if(ks.logLevel<=o.$b.DEBUG){const n=e.map(Ms);ks.debug(`Firestore (${Ns}): ${t}`,...n)}}function Os(t,...e){if(ks.logLevel<=o.$b.ERROR){const n=e.map(Ms);ks.error(`Firestore (${Ns}): ${t}`,...n)}}function Ls(t,...e){if(ks.logLevel<=o.$b.WARN){const n=e.map(Ms);ks.warn(`Firestore (${Ns}): ${t}`,...n)}}function Ms(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Fs(t="Unexpected state"){const e=`FIRESTORE (${Ns}) INTERNAL ASSERTION FAILED: `+t;throw Os(e),new Error(e)}function Ps(t,e){t||Fs()}function Vs(t,e){return t}const Us={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Bs extends a.g{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class qs{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class js{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class zs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Ds.UNAUTHENTICATED)))}shutdown(){}}class Ks{constructor(t){this.t=t,this.currentUser=Ds.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let r=new qs;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new qs,t.enqueueRetryable((()=>s(this.currentUser)))};const i=()=>{const e=r;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{Rs("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Rs("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new qs)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Rs("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Ps("string"==typeof e.accessToken),new js(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Ps(null===t||"string"==typeof t),new Ds(t)}}class $s{constructor(t,e,n){this.h=t,this.l=e,this.m=n,this.type="FirstParty",this.user=Ds.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const t=this.p();return t&&this.g.set("Authorization",t),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Gs{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new $s(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(Ds.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Qs{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Hs{constructor(t){this.I=t,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(t,e){const n=t=>{null!=t.error&&Rs("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.T;return this.T=t.token,Rs("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{Rs("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.I.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.I.getImmediate({optional:!0});t?s(t):Rs("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Ps("string"==typeof t.token),this.T=t.token,new Qs(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ws(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Xs{static A(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Ws(40);for(let s=0;s<n.length;++s)e.length<20&&n[s]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[s]%62))}return e}}function Ys(t,e){return t<e?-1:t>e?1:0}function Js(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}class Zs{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Bs(Us.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Bs(Us.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Bs(Us.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Bs(Us.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Zs.fromMillis(Date.now())}static fromDate(t){return Zs.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Zs(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Ys(this.nanoseconds,t.nanoseconds):Ys(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class tr{constructor(t){this.timestamp=t}static fromTimestamp(t){return new tr(t)}static min(){return new tr(new Zs(0,0))}static max(){return new tr(new Zs(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class er{constructor(t,e,n){void 0===e?e=0:e>t.length&&Fs(),void 0===n?n=t.length-e:n>t.length-e&&Fs(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===er.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof er?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),r=e.get(s);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class nr extends er{construct(t,e,n){return new nr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Bs(Us.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new nr(e)}static emptyPath(){return new nr([])}}const sr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rr extends er{construct(t,e,n){return new rr(t,e,n)}static isValidIdentifier(t){return sr.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rr.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new rr(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const r=()=>{if(0===n.length)throw new Bs(Us.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new Bs(Us.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Bs(Us.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(i=!i,s++):"."!==e||i?(n+=e,s++):(r(),s++)}if(r(),i)throw new Bs(Us.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new rr(e)}static emptyPath(){return new rr([])}}class ir{constructor(t){this.path=t}static fromPath(t){return new ir(nr.fromString(t))}static fromName(t){return new ir(nr.fromString(t).popFirst(5))}static empty(){return new ir(nr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===nr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return nr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ir(new nr(t.slice()))}}function or(t){return new ar(t.readTime,t.key,-1)}class ar{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new ar(tr.min(),ir.empty(),-1)}static max(){return new ar(tr.max(),ir.empty(),-1)}}function ur(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=ir.comparator(t.documentKey,e.documentKey),0!==n?n:Ys(t.largestBatchId,e.largestBatchId))}class cr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function hr(t){if(t.code!==Us.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;Rs("LocalStore","Unexpectedly lost primary lease")}class lr{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Fs(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new lr(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof lr?e:lr.resolve(e)}catch(t){return lr.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):lr.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):lr.reject(e)}static resolve(t){return new lr(((e,n)=>{e(t)}))}static reject(t){return new lr(((e,n)=>{n(t)}))}static waitFor(t){return new lr(((e,n)=>{let s=0,r=0,i=!1;t.forEach((t=>{++s,t.next((()=>{++r,i&&r===s&&e()}),(t=>n(t)))})),i=!0,r===s&&e()}))}static or(t){let e=lr.resolve(!1);for(const n of t)e=e.next((t=>t?lr.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}static mapArray(t,e){return new lr(((n,s)=>{const r=t.length,i=new Array(r);let o=0;for(let a=0;a<r;a++){const u=a;e(t[u]).next((t=>{i[u]=t,++o,o===r&&n(i)}),(t=>s(t)))}}))}static doWhile(t,e){return new lr(((n,s)=>{const r=()=>{!0===t()?e().next((()=>{r()}),s):n()};r()}))}}function dr(t){return"IndexedDbTransactionError"===t.name}class fr{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ot(t),this.ut=t=>e.writeSequenceNumber(t))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}function gr(t){return null==t}function pr(t){return 0===t&&1/t==-1/0}fr.ct=-1;function mr(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function yr(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class vr{constructor(t,e){this.comparator=t,this.root=e||Er.EMPTY}insert(t,e){return new vr(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Er.BLACK,null,null))}remove(t){return new vr(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Er.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new wr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new wr(this.root,t,this.comparator,!1)}getReverseIterator(){return new wr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new wr(this.root,t,this.comparator,!0)}}class wr{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,e&&s&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Er{constructor(t,e,n,s,r){this.key=t,this.value=e,this.color=null!=n?n:Er.RED,this.left=null!=s?s:Er.EMPTY,this.right=null!=r?r:Er.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,r){return new Er(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const r=n(t,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===r?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Er.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return Er.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Er.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Er.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Fs();if(this.right.isRed())throw Fs();const t=this.left.check();if(t!==this.right.check())throw Fs();return t+(this.isRed()?0:1)}}Er.EMPTY=null,Er.RED=!0,Er.BLACK=!1,Er.EMPTY=new class{constructor(){this.size=0}get key(){throw Fs()}get value(){throw Fs()}get color(){throw Fs()}get left(){throw Fs()}get right(){throw Fs()}copy(t,e,n,s,r){return this}insert(t,e,n){return new Er(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Tr{constructor(t){this.comparator=t,this.data=new vr(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new br(this.data.getIterator())}getIteratorFrom(t){return new br(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Tr))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Tr(this.comparator);return e.data=t,e}}class br{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Cr{constructor(t){this.fields=t,t.sort(rr.comparator)}static empty(){return new Cr([])}unionWith(t){let e=new Tr(rr.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Cr(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Js(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Sr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ar{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Sr("Invalid base64 string: "+t):t}}(t);return new Ar(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Ar(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Ys(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ar.EMPTY_BYTE_STRING=new Ar("");const Ir=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _r(t){if(Ps(!!t),"string"==typeof t){let e=0;const n=Ir.exec(t);if(Ps(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Dr(t.seconds),nanos:Dr(t.nanos)}}function Dr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Nr(t){return"string"==typeof t?Ar.fromBase64String(t):Ar.fromUint8Array(t)}function kr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function xr(t){const e=t.mapValue.fields.__previous_value__;return kr(e)?xr(e):e}function Rr(t){const e=_r(t.mapValue.fields.__local_write_time__.timestampValue);return new Zs(e.seconds,e.nanos)}class Or{constructor(t,e,n,s,r,i,o,a,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=u}}class Lr{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Lr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Lr&&t.projectId===this.projectId&&t.database===this.database}}const Mr={fields:{__type__:{stringValue:"__max__"}}};function Fr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?kr(t)?4:Wr(t)?9007199254740991:10:Fs()}function Pr(t,e){if(t===e)return!0;const n=Fr(t);if(n!==Fr(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Rr(t).isEqual(Rr(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=_r(t.timestampValue),s=_r(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Nr(t.bytesValue).isEqual(Nr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Dr(t.geoPointValue.latitude)===Dr(e.geoPointValue.latitude)&&Dr(t.geoPointValue.longitude)===Dr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Dr(t.integerValue)===Dr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Dr(t.doubleValue),s=Dr(e.doubleValue);return n===s?pr(n)===pr(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return Js(t.arrayValue.values||[],e.arrayValue.values||[],Pr);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(mr(n)!==mr(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Pr(n[t],s[t])))return!1;return!0}(t,e);default:return Fs()}}function Vr(t,e){return void 0!==(t.values||[]).find((t=>Pr(t,e)))}function Ur(t,e){if(t===e)return 0;const n=Fr(t),s=Fr(e);if(n!==s)return Ys(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ys(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Dr(t.integerValue||t.doubleValue),s=Dr(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Br(t.timestampValue,e.timestampValue);case 4:return Br(Rr(t),Rr(e));case 5:return Ys(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Nr(t),s=Nr(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=Ys(n[t],s[t]);if(0!==e)return e}return Ys(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Ys(Dr(t.latitude),Dr(e.latitude));return 0!==n?n:Ys(Dr(t.longitude),Dr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=Ur(n[t],s[t]);if(e)return e}return Ys(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Mr&&e===Mr)return 0;if(t===Mr)return 1;if(e===Mr)return-1;const n=t.fields||{},s=Object.keys(n),r=e.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let t=0;t<s.length&&t<i.length;++t){const e=Ys(s[t],i[t]);if(0!==e)return e;const o=Ur(n[s[t]],r[i[t]]);if(0!==o)return o}return Ys(s.length,i.length)}(t.mapValue,e.mapValue);default:throw Fs()}}function Br(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ys(t,e);const n=_r(t),s=_r(e),r=Ys(n.seconds,s.seconds);return 0!==r?r:Ys(n.nanos,s.nanos)}function qr(t){return jr(t)}function jr(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=_r(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Nr(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ir.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=jr(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const r of e)s?s=!1:n+=",",n+=`${r}:${jr(t.fields[r])}`;return n+"}"}(t.mapValue):Fs();var e,n}function zr(t){return!!t&&"integerValue"in t}function Kr(t){return!!t&&"arrayValue"in t}function $r(t){return!!t&&"nullValue"in t}function Gr(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Qr(t){return!!t&&"mapValue"in t}function Hr(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return yr(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Hr(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Hr(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Wr(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class Xr{constructor(t){this.value=t}static empty(){return new Xr({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Qr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Hr(e)}setAll(t){let e=rr.emptyPath(),n={},s=[];t.forEach(((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=r.popLast()}t?n[r.lastSegment()]=Hr(t):s.push(r.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,n,s)}delete(t){const e=this.field(t.popLast());Qr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Pr(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Qr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){yr(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Xr(Hr(this.value))}}class Yr{constructor(t,e,n,s,r,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=r,this.data=i,this.documentState=o}static newInvalidDocument(t){return new Yr(t,0,tr.min(),tr.min(),tr.min(),Xr.empty(),0)}static newFoundDocument(t,e,n,s){return new Yr(t,1,e,tr.min(),n,s,0)}static newNoDocument(t,e){return new Yr(t,2,e,tr.min(),tr.min(),Xr.empty(),0)}static newUnknownDocument(t,e){return new Yr(t,3,e,tr.min(),tr.min(),Xr.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(tr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Xr.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Xr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tr.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Yr&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Yr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Jr{constructor(t,e){this.position=t,this.inclusive=e}}function Zr(t,e,n){let s=0;for(let r=0;r<t.position.length;r++){const i=e[r],o=t.position[r];if(s=i.field.isKeyField()?ir.comparator(ir.fromName(o.referenceValue),n.key):Ur(o,n.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function ti(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Pr(t.position[n],e.position[n]))return!1;return!0}class ei{constructor(t,e="asc"){this.field=t,this.dir=e}}function ni(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class si{}class ri extends si{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new li(t,e,n):"array-contains"===e?new pi(t,n):"in"===e?new mi(t,n):"not-in"===e?new yi(t,n):"array-contains-any"===e?new vi(t,n):new ri(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new di(t,n):new fi(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Ur(e,this.value)):null!==e&&Fr(this.value)===Fr(e)&&this.matchesComparison(Ur(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Fs()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ii extends si{constructor(t,e){super(),this.filters=t,this.op=e,this.lt=null}static create(t,e){return new ii(t,e)}matches(t){return oi(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.ft((t=>t.isInequality()));return null!==t?t.field:null}ft(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function oi(t){return"and"===t.op}function ai(t){return function(t){for(const e of t.filters)if(e instanceof ii)return!1;return!0}(t)&&oi(t)}function ui(t){if(t instanceof ri)return t.field.canonicalString()+t.op.toString()+qr(t.value);if(ai(t))return t.filters.map((t=>ui(t))).join(",");{const e=t.filters.map((t=>ui(t))).join(",");return`${t.op}(${e})`}}function ci(t,e){return t instanceof ri?function(t,e){return e instanceof ri&&t.op===e.op&&t.field.isEqual(e.field)&&Pr(t.value,e.value)}(t,e):t instanceof ii?function(t,e){return e instanceof ii&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,s)=>t&&ci(n,e.filters[s])),!0)}(t,e):void Fs()}function hi(t){return t instanceof ri?function(t){return`${t.field.canonicalString()} ${t.op} ${qr(t.value)}`}(t):t instanceof ii?function(t){return t.op.toString()+" {"+t.getFilters().map(hi).join(" ,")+"}"}(t):"Filter"}class li extends ri{constructor(t,e,n){super(t,e,n),this.key=ir.fromName(n.referenceValue)}matches(t){const e=ir.comparator(t.key,this.key);return this.matchesComparison(e)}}class di extends ri{constructor(t,e){super(t,"in",e),this.keys=gi(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class fi extends ri{constructor(t,e){super(t,"not-in",e),this.keys=gi(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function gi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>ir.fromName(t.referenceValue)))}class pi extends ri{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Kr(e)&&Vr(e.arrayValue,this.value)}}class mi extends ri{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Vr(this.value.arrayValue,e)}}class yi extends ri{constructor(t,e){super(t,"not-in",e)}matches(t){if(Vr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Vr(this.value.arrayValue,e)}}class vi extends ri{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Kr(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Vr(this.value.arrayValue,t)))}}class wi{constructor(t,e=null,n=[],s=[],r=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=o,this.dt=null}}function Ei(t,e=null,n=[],s=[],r=null,i=null,o=null){return new wi(t,e,n,s,r,i,o)}function Ti(t){const e=Vs(t);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>ui(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),gr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>qr(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>qr(t))).join(",")),e.dt=t}return e.dt}function bi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ni(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!ci(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ti(t.startAt,e.startAt)&&ti(t.endAt,e.endAt)}function Ci(t){return ir.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Si{constructor(t,e=null,n=[],s=[],r=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=i,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function Ai(t){return new Si(t)}function Ii(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function _i(t){const e=Vs(t);if(null===e.wt){e.wt=[];const t=function(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}(e),n=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new ei(t)),e.wt.push(new ei(rr.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new ei(rr.keyField(),t))}}}return e.wt}function Di(t){const e=Vs(t);if(!e._t)if("F"===e.limitType)e._t=Ei(e.path,e.collectionGroup,_i(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of _i(e)){const e="desc"===n.dir?"asc":"desc";t.push(new ei(n.field,e))}const n=e.endAt?new Jr(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new Jr(e.startAt.position,e.startAt.inclusive):null;e._t=Ei(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e._t}function Ni(t,e,n){return new Si(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ki(t,e){return bi(Di(t),Di(e))&&t.limitType===e.limitType}function xi(t){return`${Ti(Di(t))}|lt:${t.limitType}`}function Ri(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>hi(t))).join(", ")}]`),gr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>qr(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>qr(t))).join(",")),`Target(${e})`}(Di(t))}; limitType=${t.limitType})`}function Oi(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ir.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of _i(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=Zr(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,_i(t),e)||t.endAt&&!function(t,e,n){const s=Zr(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,_i(t),e))}(t,e)}function Li(t){return(e,n)=>{let s=!1;for(const r of _i(t)){const t=Mi(r,e,n);if(0!==t)return t;s=s||r.field.isKeyField()}return 0}}function Mi(t,e,n){const s=t.field.isKeyField()?ir.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),r=n.data.field(t);return null!==s&&null!==r?Ur(s,r):Fs()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Fs()}}class Fi{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){yr(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}size(){return this.innerSize}}const Pi=new vr(ir.comparator);function Vi(){return Pi}const Ui=new vr(ir.comparator);function Bi(...t){let e=Ui;for(const n of t)e=e.insert(n.key,n);return e}function qi(t){let e=Ui;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function ji(){return Ki()}function zi(){return Ki()}function Ki(){return new Fi((t=>t.toString()),((t,e)=>t.isEqual(e)))}new vr(ir.comparator);const $i=new Tr(ir.comparator);function Gi(...t){let e=$i;for(const n of t)e=e.add(n);return e}const Qi=new Tr(Ys);class Hi{constructor(){this._=void 0}}function Wi(t,e,n){return t instanceof Yi?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&kr(e)&&(e=xr(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ji?Zi(t,e):t instanceof to?eo(t,e):function(t,e){const n=function(t,e){return t instanceof no?zr(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}(t,e),s=so(n)+so(t.gt);return zr(n)&&zr(t.gt)?function(t){return{integerValue:""+t}}(s):function(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pr(e)?"-0":e}}(t.serializer,s)}(t,e)}function Xi(t,e,n){return t instanceof Ji?Zi(t,e):t instanceof to?eo(t,e):n}class Yi extends Hi{}class Ji extends Hi{constructor(t){super(),this.elements=t}}function Zi(t,e){const n=ro(e);for(const e of t.elements)n.some((t=>Pr(t,e)))||n.push(e);return{arrayValue:{values:n}}}class to extends Hi{constructor(t){super(),this.elements=t}}function eo(t,e){let n=ro(e);for(const e of t.elements)n=n.filter((t=>!Pr(t,e)));return{arrayValue:{values:n}}}class no extends Hi{constructor(t,e){super(),this.serializer=t,this.gt=e}}function so(t){return Dr(t.integerValue||t.doubleValue)}function ro(t){return Kr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class io{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new io}static exists(t){return new io(void 0,t)}static updateTime(t){return new io(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function oo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class ao{}function uo(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new vo(t.key,io.none()):new fo(t.key,t.data,io.none());{const n=t.data,s=Xr.empty();let r=new Tr(rr.comparator);for(let t of e.fields)if(!r.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?s.delete(t):s.set(t,e),r=r.add(t)}return new go(t.key,s,new Cr(r.toArray()),io.none())}}function co(t,e,n){t instanceof fo?function(t,e,n){const s=t.value.clone(),r=mo(t.fieldTransforms,e,n.transformResults);s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof go?function(t,e,n){if(!oo(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=mo(t.fieldTransforms,e,n.transformResults),r=e.data;r.setAll(po(t)),r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ho(t,e,n,s){return t instanceof fo?function(t,e,n,s){if(!oo(t.precondition,e))return n;const r=t.value.clone(),i=yo(t.fieldTransforms,s,e);return r.setAll(i),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}(t,e,n,s):t instanceof go?function(t,e,n,s){if(!oo(t.precondition,e))return n;const r=yo(t.fieldTransforms,s,e),i=e.data;return i.setAll(po(t)),i.setAll(r),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,s):function(t,e,n){return oo(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function lo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Js(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ji&&e instanceof Ji||t instanceof to&&e instanceof to?Js(t.elements,e.elements,Pr):t instanceof no&&e instanceof no?Pr(t.gt,e.gt):t instanceof Yi&&e instanceof Yi}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class fo extends ao{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class go extends ao{constructor(t,e,n,s,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function po(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function mo(t,e,n){const s=new Map;Ps(t.length===n.length);for(let r=0;r<n.length;r++){const i=t[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,Xi(o,a,n[r]))}return s}function yo(t,e,n){const s=new Map;for(const r of t){const t=r.transform,i=n.data.field(r.field);s.set(r.field,Wi(t,i,e))}return s}class vo extends ao{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class wo{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&co(s,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=ho(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=ho(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=zi();return this.mutations.forEach((s=>{const r=t.get(s.key),i=r.overlayedDocument;let o=this.applyToLocalView(i,r.mutatedFields);o=e.has(s.key)?null:o;const a=uo(i,o);null!==a&&n.set(s.key,a),i.isValidDocument()||i.convertToNoDocument(tr.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Gi())}isEqual(t){return this.batchId===t.batchId&&Js(this.mutations,t.mutations,((t,e)=>lo(t,e)))&&Js(this.baseMutations,t.baseMutations,((t,e)=>lo(t,e)))}}class Eo{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class To{constructor(t,e){this.count=t,this.unchangedNames=e}}var bo,Co;function So(t){if(void 0===t)return Os("GRPC error has no .code"),Us.UNKNOWN;switch(t){case bo.OK:return Us.OK;case bo.CANCELLED:return Us.CANCELLED;case bo.UNKNOWN:return Us.UNKNOWN;case bo.DEADLINE_EXCEEDED:return Us.DEADLINE_EXCEEDED;case bo.RESOURCE_EXHAUSTED:return Us.RESOURCE_EXHAUSTED;case bo.INTERNAL:return Us.INTERNAL;case bo.UNAVAILABLE:return Us.UNAVAILABLE;case bo.UNAUTHENTICATED:return Us.UNAUTHENTICATED;case bo.INVALID_ARGUMENT:return Us.INVALID_ARGUMENT;case bo.NOT_FOUND:return Us.NOT_FOUND;case bo.ALREADY_EXISTS:return Us.ALREADY_EXISTS;case bo.PERMISSION_DENIED:return Us.PERMISSION_DENIED;case bo.FAILED_PRECONDITION:return Us.FAILED_PRECONDITION;case bo.ABORTED:return Us.ABORTED;case bo.OUT_OF_RANGE:return Us.OUT_OF_RANGE;case bo.UNIMPLEMENTED:return Us.UNIMPLEMENTED;case bo.DATA_LOSS:return Us.DATA_LOSS;default:return Fs()}}(Co=bo||(bo={}))[Co.OK=0]="OK",Co[Co.CANCELLED=1]="CANCELLED",Co[Co.UNKNOWN=2]="UNKNOWN",Co[Co.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Co[Co.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Co[Co.NOT_FOUND=5]="NOT_FOUND",Co[Co.ALREADY_EXISTS=6]="ALREADY_EXISTS",Co[Co.PERMISSION_DENIED=7]="PERMISSION_DENIED",Co[Co.UNAUTHENTICATED=16]="UNAUTHENTICATED",Co[Co.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Co[Co.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Co[Co.ABORTED=10]="ABORTED",Co[Co.OUT_OF_RANGE=11]="OUT_OF_RANGE",Co[Co.UNIMPLEMENTED=12]="UNIMPLEMENTED",Co[Co.INTERNAL=13]="INTERNAL",Co[Co.UNAVAILABLE=14]="UNAVAILABLE",Co[Co.DATA_LOSS=15]="DATA_LOSS";class Ao{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Io}static getOrCreateInstance(){return null===Io&&(Io=new Ao),Io}onExistenceFilterMismatch(t){const e=Symbol();return this.onExistenceFilterMismatchCallbacks.set(e,t),()=>this.onExistenceFilterMismatchCallbacks.delete(e)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach((e=>e(t)))}}let Io=null;const _o=new Is([4294967295,4294967295],0);function Do(t){const e=(new TextEncoder).encode(t),n=new As;return n.update(e),new Uint8Array(n.digest())}function No(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Is([n,s],0),new Is([r,i],0)]}class ko{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new xo(`Invalid padding: ${e}`);if(n<0)throw new xo(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new xo(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new xo(`Invalid padding when bitmap length is 0: ${e}`);this.It=8*t.length-e,this.Tt=Is.fromNumber(this.It)}Et(t,e,n){let s=t.add(e.multiply(Is.fromNumber(n)));return 1===s.compare(_o)&&(s=new Is([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Tt).toNumber()}At(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}vt(t){if(0===this.It)return!1;const e=Do(t),[n,s]=No(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,s,t);if(!this.At(e))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),i=new ko(r,s,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.It)return;const e=Do(t),[n,s]=No(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,s,t);this.Rt(e)}}Rt(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class xo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ro{constructor(t,e,n,s,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,Oo.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Ro(tr.min(),s,new vr(Ys),Vi(),Gi())}}class Oo{constructor(t,e,n,s,r){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Oo(n,e,Gi(),Gi(),Gi())}}class Lo{constructor(t,e,n,s){this.Pt=t,this.removedTargetIds=e,this.key=n,this.bt=s}}class Mo{constructor(t,e){this.targetId=t,this.Vt=e}}class Fo{constructor(t,e,n=Ar.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Po{constructor(){this.St=0,this.Dt=Bo(),this.Ct=Ar.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(t){t.approximateByteSize()>0&&(this.Nt=!0,this.Ct=t)}Ot(){let t=Gi(),e=Gi(),n=Gi();return this.Dt.forEach(((s,r)=>{switch(r){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:Fs()}})),new Oo(this.Ct,this.xt,t,e,n)}Ft(){this.Nt=!1,this.Dt=Bo()}Bt(t,e){this.Nt=!0,this.Dt=this.Dt.insert(t,e)}Lt(t){this.Nt=!0,this.Dt=this.Dt.remove(t)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class Vo{constructor(t){this.Gt=t,this.Qt=new Map,this.jt=Vi(),this.zt=Uo(),this.Wt=new vr(Ys)}Ht(t){for(const e of t.Pt)t.bt&&t.bt.isFoundDocument()?this.Jt(e,t.bt):this.Yt(e,t.key,t.bt);for(const e of t.removedTargetIds)this.Yt(e,t.key,t.bt)}Xt(t){this.forEachTarget(t,(e=>{const n=this.Zt(e);switch(t.state){case 0:this.te(e)&&n.$t(t.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(t.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(e);break;case 3:this.te(e)&&(n.Kt(),n.$t(t.resumeToken));break;case 4:this.te(e)&&(this.ee(e),n.$t(t.resumeToken));break;default:Fs()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Qt.forEach(((t,n)=>{this.te(n)&&e(n)}))}ne(t){var e;const n=t.targetId,s=t.Vt.count,r=this.se(n);if(r){const i=r.target;if(Ci(i))if(0===s){const t=new ir(i.path);this.Yt(n,t,Yr.newNoDocument(t,tr.min()))}else Ps(1===s);else{const r=this.ie(n);if(r!==s){const s=this.re(t,r);if(0!==s){this.ee(n);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,t)}null===(e=Ao.instance)||void 0===e||e.notifyOnExistenceFilterMismatch(function(t,e,n){var s,r,i,o,a,u;const c={localCacheCount:e,existenceFilterCount:n.count},h=n.unchangedNames;return h&&(c.bloomFilter={applied:0===t,hashCount:null!==(s=null==h?void 0:h.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(o=null===(i=null===(r=null==h?void 0:h.bits)||void 0===r?void 0:r.bitmap)||void 0===i?void 0:i.length)&&void 0!==o?o:0,padding:null!==(u=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.padding)&&void 0!==u?u:0}),c}(s,r,t.Vt))}}}}re(t,e){const{unchangedNames:n,count:s}=t.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let a,u;try{a=Nr(r).toUint8Array()}catch(t){if(t instanceof Sr)return Ls("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw t}try{u=new ko(a,i,o)}catch(t){return Ls(t instanceof xo?"BloomFilter error: ":"Applying bloom filter failed: ",t),1}return 0===u.It?1:s!==e-this.oe(t.targetId,u)?2:0}oe(t,e){const n=this.Gt.getRemoteKeysForTarget(t);let s=0;return n.forEach((n=>{const r=this.Gt.ue(),i=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.vt(i)||(this.Yt(t,n,null),s++)})),s}ce(t){const e=new Map;this.Qt.forEach(((n,s)=>{const r=this.se(s);if(r){if(n.current&&Ci(r.target)){const e=new ir(r.target.path);null!==this.jt.get(e)||this.ae(s,e)||this.Yt(s,e,Yr.newNoDocument(e,t))}n.Mt&&(e.set(s,n.Ot()),n.Ft())}}));let n=Gi();this.zt.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.se(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.jt.forEach(((e,n)=>n.setReadTime(t)));const s=new Ro(t,e,this.Wt,this.jt,n);return this.jt=Vi(),this.zt=Uo(),this.Wt=new vr(Ys),s}Jt(t,e){if(!this.te(t))return;const n=this.ae(t,e.key)?2:0;this.Zt(t).Bt(e.key,n),this.jt=this.jt.insert(e.key,e),this.zt=this.zt.insert(e.key,this.he(e.key).add(t))}Yt(t,e,n){if(!this.te(t))return;const s=this.Zt(t);this.ae(t,e)?s.Bt(e,1):s.Lt(e),this.zt=this.zt.insert(e,this.he(e).delete(t)),n&&(this.jt=this.jt.insert(e,n))}removeTarget(t){this.Qt.delete(t)}ie(t){const e=this.Zt(t).Ot();return this.Gt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}qt(t){this.Zt(t).qt()}Zt(t){let e=this.Qt.get(t);return e||(e=new Po,this.Qt.set(t,e)),e}he(t){let e=this.zt.get(t);return e||(e=new Tr(Ys),this.zt=this.zt.insert(t,e)),e}te(t){const e=null!==this.se(t);return e||Rs("WatchChangeAggregator","Detected inactive target",t),e}se(t){const e=this.Qt.get(t);return e&&e.kt?null:this.Gt.le(t)}ee(t){this.Qt.set(t,new Po),this.Gt.getRemoteKeysForTarget(t).forEach((e=>{this.Yt(t,e,null)}))}ae(t,e){return this.Gt.getRemoteKeysForTarget(t).has(e)}}function Uo(){return new vr(ir.comparator)}function Bo(){return new vr(ir.comparator)}const qo={asc:"ASCENDING",desc:"DESCENDING"},jo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zo={and:"AND",or:"OR"};class Ko{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function $o(t,e){return t.useProto3Json||gr(e)?e:{value:e}}function Go(t){return Ps(!!t),tr.fromTimestamp(function(t){const e=_r(t);return new Zs(e.seconds,e.nanos)}(t))}function Qo(t){const e=nr.fromString(t);return Ps(ua(e)),e}function Ho(t,e){const n=Qo(e);if(n.get(1)!==t.databaseId.projectId)throw new Bs(Us.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Bs(Us.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ir(Yo(n))}function Wo(t,e){return function(t,e){return function(t){return new nr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}(t.databaseId,e)}function Xo(t){return new nr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Yo(t){return Ps(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Jo(t,e){return{documents:[Wo(t,e.path)]}}function Zo(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=Wo(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Wo(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const r=function(t){if(0!==t.length)return aa(ii.create(t,"and"))}(e.filters);r&&(n.structuredQuery.where=r);const i=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:ia(t.field),direction:na(t.dir)}}(t)))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=$o(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function ta(t){let e=function(t){const e=Qo(t);return 4===e.length?nr.emptyPath():Yo(e)}(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){Ps(1===s);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=ea(t);return e instanceof ii&&ai(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new ei(oa(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,gr(e)?null:e}(n.limit));let u=null;n.startAt&&(u=function(t){const e=!!t.before,n=t.values||[];return new Jr(n,e)}(n.startAt));let c=null;return n.endAt&&(c=function(t){const e=!t.before,n=t.values||[];return new Jr(n,e)}(n.endAt)),function(t,e,n,s,r,i,o,a){return new Si(t,e,n,s,r,i,o,a)}(e,r,o,i,a,"F",u,c)}function ea(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=oa(t.unaryFilter.field);return ri.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=oa(t.unaryFilter.field);return ri.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=oa(t.unaryFilter.field);return ri.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=oa(t.unaryFilter.field);return ri.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Fs()}}(t):void 0!==t.fieldFilter?function(t){return ri.create(oa(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Fs()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return ii.create(t.compositeFilter.filters.map((t=>ea(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Fs()}}(t.compositeFilter.op))}(t):Fs()}function na(t){return qo[t]}function sa(t){return jo[t]}function ra(t){return zo[t]}function ia(t){return{fieldPath:t.canonicalString()}}function oa(t){return rr.fromServerFormat(t.fieldPath)}function aa(t){return t instanceof ri?function(t){if("=="===t.op){if(Gr(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NAN"}};if($r(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Gr(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NOT_NAN"}};if($r(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ia(t.field),op:sa(t.op),value:t.value}}}(t):t instanceof ii?function(t){const e=t.getFilters().map((t=>aa(t)));return 1===e.length?e[0]:{compositeFilter:{op:ra(t.op),filters:e}}}(t):Fs()}function ua(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class ca{constructor(t,e,n,s,r=tr.min(),i=tr.min(),o=Ar.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new ca(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new ca(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new ca(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new ca(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class ha{constructor(t){this.fe=t}}function la(t){const e=ta({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ni(e,e.limit,"L"):e}class da{constructor(){}_e(t,e){this.me(t,e),e.ge()}me(t,e){if("nullValue"in t)this.ye(e,5);else if("booleanValue"in t)this.ye(e,10),e.pe(t.booleanValue?1:0);else if("integerValue"in t)this.ye(e,15),e.pe(Dr(t.integerValue));else if("doubleValue"in t){const n=Dr(t.doubleValue);isNaN(n)?this.ye(e,13):(this.ye(e,15),pr(n)?e.pe(0):e.pe(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ye(e,20),"string"==typeof n?e.Ie(n):(e.Ie(`${n.seconds||""}`),e.pe(n.nanos||0))}else if("stringValue"in t)this.Te(t.stringValue,e),this.Ee(e);else if("bytesValue"in t)this.ye(e,30),e.Ae(Nr(t.bytesValue)),this.Ee(e);else if("referenceValue"in t)this.ve(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ye(e,45),e.pe(n.latitude||0),e.pe(n.longitude||0)}else"mapValue"in t?Wr(t)?this.ye(e,Number.MAX_SAFE_INTEGER):(this.Re(t.mapValue,e),this.Ee(e)):"arrayValue"in t?(this.Pe(t.arrayValue,e),this.Ee(e)):Fs()}Te(t,e){this.ye(e,25),this.be(t,e)}be(t,e){e.Ie(t)}Re(t,e){const n=t.fields||{};this.ye(e,55);for(const t of Object.keys(n))this.Te(t,e),this.me(n[t],e)}Pe(t,e){const n=t.values||[];this.ye(e,50);for(const t of n)this.me(t,e)}ve(t,e){this.ye(e,37),ir.fromName(t).path.forEach((t=>{this.ye(e,60),this.be(t,e)}))}ye(t,e){t.pe(e)}Ee(t){t.pe(2)}}da.Ve=new da;class fa{constructor(){this.rn=new ga}addToCollectionParentIndex(t,e){return this.rn.add(e),lr.resolve()}getCollectionParents(t,e){return lr.resolve(this.rn.getEntries(e))}addFieldIndex(t,e){return lr.resolve()}deleteFieldIndex(t,e){return lr.resolve()}getDocumentsMatchingTarget(t,e){return lr.resolve(null)}getIndexType(t,e){return lr.resolve(0)}getFieldIndexes(t,e){return lr.resolve([])}getNextCollectionGroupToUpdate(t){return lr.resolve(null)}getMinOffset(t,e){return lr.resolve(ar.min())}getMinOffsetFromCollectionGroup(t,e){return lr.resolve(ar.min())}updateCollectionGroup(t,e,n){return lr.resolve()}updateIndexEntries(t,e){return lr.resolve()}}class ga{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new Tr(nr.comparator),r=!s.has(n);return this.index[e]=s.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new Tr(nr.comparator)).toArray()}}new Uint8Array(0);class pa{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new pa(t,pa.DEFAULT_COLLECTION_PERCENTILE,pa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}pa.DEFAULT_COLLECTION_PERCENTILE=10,pa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pa.DEFAULT=new pa(41943040,pa.DEFAULT_COLLECTION_PERCENTILE,pa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pa.DISABLED=new pa(-1,0,0);class ma{constructor(t){this.Nn=t}next(){return this.Nn+=2,this.Nn}static kn(){return new ma(0)}static Mn(){return new ma(-1)}}class ya{constructor(){this.changes=new Fi((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Yr.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?lr.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class va{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class wa{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&ho(n.mutation,t,Cr.empty(),Zs.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Gi()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Gi()){const s=ji();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((t=>{let e=Bi();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=ji();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Gi())))}populateOverlays(t,e,n){const s=[];return n.forEach((t=>{e.has(t)||s.push(t)})),this.documentOverlayCache.getOverlays(t,s).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,s){let r=Vi();const i=Ki(),o=Ki();return e.forEach(((t,e)=>{const o=n.get(e.key);s.has(e.key)&&(void 0===o||o.mutation instanceof go)?r=r.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),ho(o.mutation,e,o.mutation.getFieldMask(),Zs.now())):i.set(e.key,Cr.empty())})),this.recalculateAndSaveOverlays(t,r).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new va(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Ki();let s=new vr(((t,e)=>t-e)),r=Gi();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const r of t)r.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||Cr.empty();o=r.applyToLocalView(i,o),n.set(t,o);const a=(s.get(r.batchId)||Gi()).add(t);s=s.insert(r.batchId,a)}))})).next((()=>{const i=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,u=s.value,c=zi();u.forEach((t=>{if(!r.has(t)){const s=uo(e.get(t),n.get(t));null!==s&&c.set(t,s),r=r.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,c))}return lr.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return ir.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((r=>{const i=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-r.size):lr.resolve(ji());let o=-1,a=r;return i.next((e=>lr.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(e)?lr.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,r))).next((()=>this.computeViews(t,a,e,Gi()))).next((t=>({batchId:o,changes:qi(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new ir(e)).next((t=>{let e=Bi();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const s=e.collectionGroup;let r=Bi();return this.indexManager.getCollectionParents(t,s).next((i=>lr.forEach(i,(i=>{const o=function(t,e){return new Si(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,i.child(s));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{r=r.insert(t,e)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(t,e,n){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s)))).next((t=>{s.forEach(((e,n)=>{const s=n.getKey();null===t.get(s)&&(t=t.insert(s,Yr.newInvalidDocument(s)))}));let n=Bi();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&ho(i.mutation,r,Cr.empty(),Zs.now()),Oi(e,r)&&(n=n.insert(t,r))})),n}))}}class Ea{constructor(t){this.serializer=t,this.cs=new Map,this.hs=new Map}getBundleMetadata(t,e){return lr.resolve(this.cs.get(e))}saveBundleMetadata(t,e){var n;return this.cs.set(e.id,{id:(n=e).id,version:n.version,createTime:Go(n.createTime)}),lr.resolve()}getNamedQuery(t,e){return lr.resolve(this.hs.get(e))}saveNamedQuery(t,e){return this.hs.set(e.name,function(t){return{name:t.name,query:la(t.bundledQuery),readTime:Go(t.readTime)}}(e)),lr.resolve()}}class Ta{constructor(){this.overlays=new vr(ir.comparator),this.ls=new Map}getOverlay(t,e){return lr.resolve(this.overlays.get(e))}getOverlays(t,e){const n=ji();return lr.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,s)=>{this.we(t,e,s)})),lr.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.ls.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.ls.delete(n)),lr.resolve()}getOverlaysForCollection(t,e,n){const s=ji(),r=e.length+1,i=new ir(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===r&&t.largestBatchId>n&&s.set(t.getKey(),t)}return lr.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let r=new vr(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=r.get(t.largestBatchId);null===e&&(e=ji(),r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=ji(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=s)););return lr.resolve(o)}we(t,e,n){const s=this.overlays.get(n.key);if(null!==s){const t=this.ls.get(s.largestBatchId).delete(n.key);this.ls.set(s.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Eo(e,n));let r=this.ls.get(e);void 0===r&&(r=Gi(),this.ls.set(e,r)),this.ls.set(e,r.add(n.key))}}class ba{constructor(){this.fs=new Tr(Ca.ds),this.ws=new Tr(Ca._s)}isEmpty(){return this.fs.isEmpty()}addReference(t,e){const n=new Ca(t,e);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ys(new Ca(t,e))}ps(t,e){t.forEach((t=>this.removeReference(t,e)))}Is(t){const e=new ir(new nr([])),n=new Ca(e,t),s=new Ca(e,t+1),r=[];return this.ws.forEachInRange([n,s],(t=>{this.ys(t),r.push(t.key)})),r}Ts(){this.fs.forEach((t=>this.ys(t)))}ys(t){this.fs=this.fs.delete(t),this.ws=this.ws.delete(t)}Es(t){const e=new ir(new nr([])),n=new Ca(e,t),s=new Ca(e,t+1);let r=Gi();return this.ws.forEachInRange([n,s],(t=>{r=r.add(t.key)})),r}containsKey(t){const e=new Ca(t,0),n=this.fs.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Ca{constructor(t,e){this.key=t,this.As=e}static ds(t,e){return ir.comparator(t.key,e.key)||Ys(t.As,e.As)}static _s(t,e){return Ys(t.As,e.As)||ir.comparator(t.key,e.key)}}class Sa{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.vs=1,this.Rs=new Tr(Ca.ds)}checkEmpty(t){return lr.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,s){const r=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new wo(r,e,n,s);this.mutationQueue.push(i);for(const e of s)this.Rs=this.Rs.add(new Ca(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return lr.resolve(i)}lookupMutationBatch(t,e){return lr.resolve(this.Ps(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.bs(n),r=s<0?0:s;return lr.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return lr.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(t){return lr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Ca(e,0),s=new Ca(e,Number.POSITIVE_INFINITY),r=[];return this.Rs.forEachInRange([n,s],(t=>{const e=this.Ps(t.As);r.push(e)})),lr.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Tr(Ys);return e.forEach((t=>{const e=new Ca(t,0),s=new Ca(t,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([e,s],(t=>{n=n.add(t.As)}))})),lr.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let r=n;ir.isDocumentKey(r)||(r=r.child(""));const i=new Ca(new ir(r),0);let o=new Tr(Ys);return this.Rs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.As)),!0)}),i),lr.resolve(this.Vs(o))}Vs(t){const e=[];return t.forEach((t=>{const n=this.Ps(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Ps(0===this.Ss(e.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return lr.forEach(e.mutations,(s=>{const r=new Ca(s.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Rs=n}))}Cn(t){}containsKey(t,e){const n=new Ca(e,0),s=this.Rs.firstAfterOrEqual(n);return lr.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,lr.resolve()}Ss(t,e){return this.bs(t)}bs(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Ps(t){const e=this.bs(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Aa{constructor(t){this.Ds=t,this.docs=new vr(ir.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),r=s?s.size:0,i=this.Ds(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return lr.resolve(n?n.document.mutableCopy():Yr.newInvalidDocument(e))}getEntries(t,e){let n=Vi();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Yr.newInvalidDocument(t))})),lr.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let r=Vi();const i=e.path,o=new ir(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||ur(or(o),n)<=0||(s.has(o.key)||Oi(e,o))&&(r=r.insert(o.key,o.mutableCopy()))}return lr.resolve(r)}getAllFromCollectionGroup(t,e,n,s){Fs()}Cs(t,e){return lr.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Ia(this)}getSize(t){return lr.resolve(this.size)}}class Ia extends ya{constructor(t){super(),this.os=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.os.addEntry(t,s)):this.os.removeEntry(n)})),lr.waitFor(e)}getFromCache(t,e){return this.os.getEntry(t,e)}getAllFromCache(t,e){return this.os.getEntries(t,e)}}class _a{constructor(t){this.persistence=t,this.xs=new Fi((t=>Ti(t)),bi),this.lastRemoteSnapshotVersion=tr.min(),this.highestTargetId=0,this.Ns=0,this.ks=new ba,this.targetCount=0,this.Ms=ma.kn()}forEachTarget(t,e){return this.xs.forEach(((t,n)=>e(n))),lr.resolve()}getLastRemoteSnapshotVersion(t){return lr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return lr.resolve(this.Ns)}allocateTargetId(t){return this.highestTargetId=this.Ms.next(),lr.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ns&&(this.Ns=e),lr.resolve()}Fn(t){this.xs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ms=new ma(e),this.highestTargetId=e),t.sequenceNumber>this.Ns&&(this.Ns=t.sequenceNumber)}addTargetData(t,e){return this.Fn(e),this.targetCount+=1,lr.resolve()}updateTargetData(t,e){return this.Fn(e),lr.resolve()}removeTargetData(t,e){return this.xs.delete(e.target),this.ks.Is(e.targetId),this.targetCount-=1,lr.resolve()}removeTargets(t,e,n){let s=0;const r=[];return this.xs.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.xs.delete(i),r.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),lr.waitFor(r).next((()=>s))}getTargetCount(t){return lr.resolve(this.targetCount)}getTargetData(t,e){const n=this.xs.get(e)||null;return lr.resolve(n)}addMatchingKeys(t,e,n){return this.ks.gs(e,n),lr.resolve()}removeMatchingKeys(t,e,n){this.ks.ps(e,n);const s=this.persistence.referenceDelegate,r=[];return s&&e.forEach((e=>{r.push(s.markPotentiallyOrphaned(t,e))})),lr.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this.ks.Is(e),lr.resolve()}getMatchingKeysForTargetId(t,e){const n=this.ks.Es(e);return lr.resolve(n)}containsKey(t,e){return lr.resolve(this.ks.containsKey(e))}}class Da{constructor(t,e){this.$s={},this.overlays={},this.Os=new fr(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=t(this),this.Bs=new _a(this),this.indexManager=new fa,this.remoteDocumentCache=function(t){return new Aa(t)}((t=>this.referenceDelegate.Ls(t))),this.serializer=new ha(e),this.qs=new Ea(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Ta,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.$s[t.toKey()];return n||(n=new Sa(e,this.referenceDelegate),this.$s[t.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(t,e,n){Rs("MemoryPersistence","Starting transaction:",t);const s=new Na(this.Os.next());return this.referenceDelegate.Us(),n(s).next((t=>this.referenceDelegate.Ks(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Gs(t,e){return lr.or(Object.values(this.$s).map((n=>()=>n.containsKey(t,e))))}}class Na extends cr{constructor(t){super(),this.currentSequenceNumber=t}}class ka{constructor(t){this.persistence=t,this.Qs=new ba,this.js=null}static zs(t){return new ka(t)}get Ws(){if(this.js)return this.js;throw Fs()}addReference(t,e,n){return this.Qs.addReference(n,e),this.Ws.delete(n.toString()),lr.resolve()}removeReference(t,e,n){return this.Qs.removeReference(n,e),this.Ws.add(n.toString()),lr.resolve()}markPotentiallyOrphaned(t,e){return this.Ws.add(e.toString()),lr.resolve()}removeTarget(t,e){this.Qs.Is(e.targetId).forEach((t=>this.Ws.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Ws.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Us(){this.js=new Set}Ks(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return lr.forEach(this.Ws,(n=>{const s=ir.fromPath(n);return this.Hs(t,s).next((t=>{t||e.removeEntry(s,tr.min())}))})).next((()=>(this.js=null,e.apply(t))))}updateLimboDocument(t,e){return this.Hs(t,e).next((t=>{t?this.Ws.delete(e.toString()):this.Ws.add(e.toString())}))}Ls(t){return 0}Hs(t,e){return lr.or([()=>lr.resolve(this.Qs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gs(t,e)])}}class xa{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Fi=n,this.Bi=s}static Li(t,e){let n=Gi(),s=Gi();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new xa(t,e.fromCache,n,s)}}class Ra{constructor(){this.qi=!1}initialize(t,e){this.Ui=t,this.indexManager=e,this.qi=!0}getDocumentsMatchingQuery(t,e,n,s){return this.Ki(t,e).next((r=>r||this.Gi(t,e,s,n))).next((n=>n||this.Qi(t,e)))}Ki(t,e){if(Ii(e))return lr.resolve(null);let n=Di(e);return this.indexManager.getIndexType(t,n).next((s=>0===s?null:(null!==e.limit&&1===s&&(e=Ni(e,null,"F"),n=Di(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((s=>{const r=Gi(...s);return this.Ui.getDocuments(t,r).next((s=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.ji(e,s);return this.zi(e,i,r,n.readTime)?this.Ki(t,Ni(e,null,"F")):this.Wi(t,i,e,n)}))))})))))}Gi(t,e,n,s){return Ii(e)||s.isEqual(tr.min())?this.Qi(t,e):this.Ui.getDocuments(t,n).next((r=>{const i=this.ji(e,r);return this.zi(e,i,n,s)?this.Qi(t,e):(xs()<=o.$b.DEBUG&&Rs("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ri(e)),this.Wi(t,i,e,function(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,r=tr.fromTimestamp(1e9===s?new Zs(n+1,0):new Zs(n,s));return new ar(r,ir.empty(),e)}(s,-1)))}))}ji(t,e){let n=new Tr(Li(t));return e.forEach(((e,s)=>{Oi(t,s)&&(n=n.add(s))})),n}zi(t,e,n,s){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const r="F"===t.limitType?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Qi(t,e){return xs()<=o.$b.DEBUG&&Rs("QueryEngine","Using full collection scan to execute query:",Ri(e)),this.Ui.getDocumentsMatchingQuery(t,e,ar.min())}Wi(t,e,n,s){return this.Ui.getDocumentsMatchingQuery(t,n,s).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Oa{constructor(t,e,n,s){this.persistence=t,this.Hi=e,this.serializer=s,this.Ji=new vr(Ys),this.Yi=new Fi((t=>Ti(t)),bi),this.Xi=new Map,this.Zi=t.getRemoteDocumentCache(),this.Bs=t.getTargetCache(),this.qs=t.getBundleCache(),this.tr(n)}tr(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new wa(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ji)))}}async function La(t,e){const n=Vs(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.mutationQueue.getAllMutationBatches(t).next((r=>(s=r,n.tr(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const r=[],i=[];let o=Gi();for(const t of s){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({er:t,removedBatchIds:r,addedBatchIds:i})))}))}))}function Ma(t){const e=Vs(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Bs.getLastRemoteSnapshotVersion(t)))}async function Fa(t,e,n){const s=Vs(t),r=s.Ji.get(e),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,(t=>s.persistence.referenceDelegate.removeTarget(t,r)))}catch(t){if(!dr(t))throw t;Rs("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Ji=s.Ji.remove(e),s.Yi.delete(r.target)}function Pa(t,e,n){const s=Vs(t);let r=tr.min(),i=Gi();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=Vs(t),r=s.Yi.get(n);return void 0!==r?lr.resolve(s.Ji.get(r)):s.Bs.getTargetData(e,n)}(s,t,Di(e)).next((e=>{if(e)return r=e.lastLimboFreeSnapshotVersion,s.Bs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>s.Hi.getDocumentsMatchingQuery(t,e,n?r:tr.min(),n?i:Gi()))).next((t=>(function(t,e,n){let s=t.Xi.get(e)||tr.min();n.forEach(((t,e)=>{e.readTime.compareTo(s)>0&&(s=e.readTime)})),t.Xi.set(e,s)}(s,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ir:i})))))}class Va{constructor(){this.activeTargetIds=Qi}lr(t){this.activeTargetIds=this.activeTargetIds.add(t)}dr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}hr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ua{constructor(){this.Hr=new Va,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Hr.lr(t),this.Jr[t]||"not-current"}updateQueryState(t,e,n){this.Jr[t]=e}removeLocalQueryTarget(t){this.Hr.dr(t)}isLocalQueryTarget(t){return this.Hr.activeTargetIds.has(t)}clearQueryState(t){delete this.Jr[t]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(t){return this.Hr.activeTargetIds.has(t)}start(){return this.Hr=new Va,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Ba{Yr(t){}shutdown(){}}class qa{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(t){this.so.push(t)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){Rs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.so)t(0)}no(){Rs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.so)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ja=null;function za(){return null===ja?ja=268435456+Math.round(2147483648*Math.random()):ja++,"0x"+ja.toString(16)}const Ka={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class $a{constructor(t){this.ro=t.ro,this.oo=t.oo}uo(t){this.co=t}ao(t){this.ho=t}onMessage(t){this.lo=t}close(){this.oo()}send(t){this.ro(t)}fo(){this.co()}wo(t){this.ho(t)}_o(t){this.lo(t)}}const Ga="WebChannelConnection";class Qa extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.mo=e+"://"+t.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(t,e,n,s,r){const i=za(),o=this.To(t,e);Rs("RestConnection",`Sending RPC '${t}' ${i}:`,o,n);const a={};return this.Eo(a,s,r),this.Ao(t,o,a,n).then((e=>(Rs("RestConnection",`Received RPC '${t}' ${i}: `,e),e)),(e=>{throw Ls("RestConnection",`RPC '${t}' ${i} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,s,r,i){return this.Io(t,e,n,s,r)}Eo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Ns,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}To(t,e){const n=Ka[t];return`${this.mo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Ao(t,e,n,s){const r=za();return new Promise(((i,o)=>{const a=new Ss;a.setWithCredentials(!0),a.listenOnce(ws.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case vs.NO_ERROR:const e=a.getResponseJson();Rs(Ga,`XHR for RPC '${t}' ${r} received:`,JSON.stringify(e)),i(e);break;case vs.TIMEOUT:Rs(Ga,`RPC '${t}' ${r} timed out`),o(new Bs(Us.DEADLINE_EXCEEDED,"Request time out"));break;case vs.HTTP_ERROR:const n=a.getStatus();if(Rs(Ga,`RPC '${t}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Us).indexOf(e)>=0?e:Us.UNKNOWN}(e.status);o(new Bs(t,e.message))}else o(new Bs(Us.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Bs(Us.UNAVAILABLE,"Connection failed."));break;default:Fs()}}finally{Rs(Ga,`RPC '${t}' ${r} completed.`)}}));const u=JSON.stringify(s);Rs(Ga,`RPC '${t}' ${r} sending request:`,s),a.send(e,"POST",u,n,15)}))}Ro(t,e,n){const s=za(),r=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=ms(),o=ys(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(a.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(a.xmlHttpFactory=new bs({})),this.Eo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const c=r.join("");Rs(Ga,`Creating RPC '${t}' stream ${s}: ${c}`,a);const h=i.createWebChannel(c,a);let l=!1,d=!1;const f=new $a({ro:e=>{d?Rs(Ga,`Not sending because RPC '${t}' stream ${s} is closed:`,e):(l||(Rs(Ga,`Opening RPC '${t}' stream ${s} transport.`),h.open(),l=!0),Rs(Ga,`RPC '${t}' stream ${s} sending:`,e),h.send(e))},oo:()=>h.close()}),g=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return g(h,Cs.EventType.OPEN,(()=>{d||Rs(Ga,`RPC '${t}' stream ${s} transport opened.`)})),g(h,Cs.EventType.CLOSE,(()=>{d||(d=!0,Rs(Ga,`RPC '${t}' stream ${s} transport closed`),f.wo())})),g(h,Cs.EventType.ERROR,(e=>{d||(d=!0,Ls(Ga,`RPC '${t}' stream ${s} transport errored:`,e),f.wo(new Bs(Us.UNAVAILABLE,"The operation could not be completed")))})),g(h,Cs.EventType.MESSAGE,(e=>{var n;if(!d){const r=e.data[0];Ps(!!r);const i=r,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){Rs(Ga,`RPC '${t}' stream ${s} received error:`,o);const e=o.status;let n=function(t){const e=bo[t];if(void 0!==e)return So(e)}(e),r=o.message;void 0===n&&(n=Us.INTERNAL,r="Unknown error status: "+e+" with message "+o.message),d=!0,f.wo(new Bs(n,r)),h.close()}else Rs(Ga,`RPC '${t}' stream ${s} received:`,r),f._o(r)}})),g(o,Es.STAT_EVENT,(e=>{e.stat===Ts.PROXY?Rs(Ga,`RPC '${t}' stream ${s} detected buffering proxy`):e.stat===Ts.NOPROXY&&Rs(Ga,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function Ha(){return"undefined"!=typeof document?document:null}function Wa(t){return new Ko(t,!0)}class Xa{constructor(t,e,n=1e3,s=1.5,r=6e4){this.ii=t,this.timerId=e,this.Po=n,this.bo=s,this.Vo=r,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(t){this.cancel();const e=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),s=Math.max(0,e-n);s>0&&Rs("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.So} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,s,(()=>(this.Co=Date.now(),t()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Ya{constructor(t,e,n,s,r,i,o,a){this.ii=t,this.$o=n,this.Oo=s,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Xa(t,e)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(t){this.Ho(),this.stream.send(t)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(t,e){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==t?this.qo.reset():e&&e.code===Us.RESOURCE_EXHAUSTED?(Os(e.toString()),Os("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):e&&e.code===Us.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.ao(e)}Yo(){}auth(){this.state=1;const t=this.Xo(this.Fo),e=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Fo===e&&this.Zo(t,n)}),(e=>{t((()=>{const t=new Bs(Us.UNKNOWN,"Fetching auth token failed: "+e.message);return this.tu(t)}))}))}Zo(t,e){const n=this.Xo(this.Fo);this.stream=this.eu(t,e),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((t=>{n((()=>this.tu(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(t){return Rs("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Xo(t){return e=>{this.ii.enqueueAndForget((()=>this.Fo===t?e():(Rs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ja extends Ya{constructor(t,e,n,s,r,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,i),this.serializer=r}eu(t,e){return this.connection.Ro("Listen",t,e)}onMessage(t){this.qo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Fs()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(Ps(void 0===e||"string"==typeof e),Ar.fromBase64String(e||"")):(Ps(void 0===e||e instanceof Uint8Array),Ar.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Us.UNKNOWN:So(t.code);return new Bs(e,t.message||"")}(o);n=new Fo(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=Ho(t,s.document.name),i=Go(s.document.updateTime),o=s.document.createTime?Go(s.document.createTime):tr.min(),a=new Xr({mapValue:{fields:s.document.fields}}),u=Yr.newFoundDocument(r,i,o,a),c=s.targetIds||[],h=s.removedTargetIds||[];n=new Lo(c,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=Ho(t,s.document),i=s.readTime?Go(s.readTime):tr.min(),o=Yr.newNoDocument(r,i),a=s.removedTargetIds||[];n=new Lo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=Ho(t,s.document),i=s.removedTargetIds||[];n=new Lo([],i,r,null)}else{if(!("filter"in e))return Fs();{e.filter;const t=e.filter;t.targetId;const{count:s=0,unchangedNames:r}=t,i=new To(s,r),o=t.targetId;n=new Mo(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return tr.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?tr.min():e.readTime?Go(e.readTime):tr.min()}(t);return this.listener.nu(e,n)}su(t){const e={};e.database=Xo(this.serializer),e.addTarget=function(t,e){let n;const s=e.target;if(n=Ci(s)?{documents:Jo(t,s)}:{query:Zo(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=function(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}(t,e.resumeToken);const s=$o(t,e.expectedCount);null!==s&&(n.expectedCount=s)}else if(e.snapshotVersion.compareTo(tr.min())>0){n.readTime=function(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}(t,e.snapshotVersion.toTimestamp());const s=$o(t,e.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Fs()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Wo(e)}iu(t){const e={};e.database=Xo(this.serializer),e.removeTarget=t,this.Wo(e)}}class Za extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.lu=!1}fu(){if(this.lu)throw new Bs(Us.FAILED_PRECONDITION,"The client has already been terminated.")}Io(t,e,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.connection.Io(t,e,n,s,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Us.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Bs(Us.UNKNOWN,t.toString())}))}vo(t,e,n,s){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.vo(t,e,n,r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Us.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Bs(Us.UNKNOWN,t.toString())}))}terminate(){this.lu=!0}}class tu{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(t){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.yu("Offline")))}set(t){this.Tu(),this.wu=0,"Online"===t&&(this.mu=!1),this.yu(t)}yu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}pu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Os(e),this.mu=!1):Rs("OnlineStateTracker",e)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class eu{constructor(t,e,n,s,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=r,this.Pu.Yr((t=>{n.enqueueAndForget((async()=>{hu(this)&&(Rs("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Vs(t);e.vu.add(4),await su(e),e.bu.set("Unknown"),e.vu.delete(4),await nu(e)}(this))}))})),this.bu=new tu(n,s)}}async function nu(t){if(hu(t))for(const e of t.Ru)await e(!0)}async function su(t){for(const e of t.Ru)await e(!1)}function ru(t,e){const n=Vs(t);n.Au.has(e.targetId)||(n.Au.set(e.targetId,e),cu(n)?uu(n):yu(n).Ko()&&ou(n,e))}function iu(t,e){const n=Vs(t),s=yu(n);n.Au.delete(e),s.Ko()&&au(n,e),0===n.Au.size&&(s.Ko()?s.jo():hu(n)&&n.bu.set("Unknown"))}function ou(t,e){if(t.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(tr.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}yu(t).su(e)}function au(t,e){t.Vu.qt(e),yu(t).iu(e)}function uu(t){t.Vu=new Vo({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),le:e=>t.Au.get(e)||null,ue:()=>t.datastore.serializer.databaseId}),yu(t).start(),t.bu.gu()}function cu(t){return hu(t)&&!yu(t).Uo()&&t.Au.size>0}function hu(t){return 0===Vs(t).vu.size}function lu(t){t.Vu=void 0}async function du(t){t.Au.forEach(((e,n)=>{ou(t,e)}))}async function fu(t,e){lu(t),cu(t)?(t.bu.Iu(e),uu(t)):t.bu.set("Unknown")}async function gu(t,e,n){if(t.bu.set("Online"),e instanceof Fo&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.Au.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.Au.delete(s),t.Vu.removeTarget(s))}(t,e)}catch(n){Rs("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await pu(t,n)}else if(e instanceof Lo?t.Vu.Ht(e):e instanceof Mo?t.Vu.ne(e):t.Vu.Xt(e),!n.isEqual(tr.min()))try{const e=await Ma(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Vu.ce(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const r=t.Au.get(s);r&&t.Au.set(s,r.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const s=t.Au.get(e);if(!s)return;t.Au.set(e,s.withResumeToken(Ar.EMPTY_BYTE_STRING,s.snapshotVersion)),au(t,e);const r=new ca(s.target,e,n,s.sequenceNumber);ou(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Rs("RemoteStore","Failed to raise snapshot:",e),await pu(t,e)}}async function pu(t,e,n){if(!dr(e))throw e;t.vu.add(1),await su(t),t.bu.set("Offline"),n||(n=()=>Ma(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Rs("RemoteStore","Retrying IndexedDB access"),await n(),t.vu.delete(1),await nu(t)}))}async function mu(t,e){const n=Vs(t);n.asyncQueue.verifyOperationInProgress(),Rs("RemoteStore","RemoteStore received new credentials");const s=hu(n);n.vu.add(3),await su(n),s&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.vu.delete(3),await nu(n)}function yu(t){return t.Su||(t.Su=function(t,e,n){const s=Vs(t);return s.fu(),new Ja(e,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(t.datastore,t.asyncQueue,{uo:du.bind(null,t),ao:fu.bind(null,t),nu:gu.bind(null,t)}),t.Ru.push((async e=>{e?(t.Su.Qo(),cu(t)?uu(t):t.bu.set("Unknown")):(await t.Su.stop(),lu(t))}))),t.Su}class vu{constructor(t,e,n,s,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new qs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,r){const i=Date.now()+n,o=new vu(t,e,i,s,r);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Bs(Us.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wu(t,e){if(Os("AsyncQueue",`${e}: ${t}`),dr(t))return new Bs(Us.UNAVAILABLE,`${e}: ${t}`);throw t}class Eu{constructor(t){this.comparator=t?(e,n)=>t(e,n)||ir.comparator(e.key,n.key):(t,e)=>ir.comparator(t.key,e.key),this.keyedMap=Bi(),this.sortedSet=new vr(this.comparator)}static emptySet(t){return new Eu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Eu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Eu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Tu{constructor(){this.Cu=new vr(ir.comparator)}track(t){const e=t.doc.key,n=this.Cu.get(e);n?0!==t.type&&3===n.type?this.Cu=this.Cu.insert(e,t):3===t.type&&1!==n.type?this.Cu=this.Cu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Cu=this.Cu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Cu=this.Cu.remove(e):1===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):Fs():this.Cu=this.Cu.insert(e,t)}xu(){const t=[];return this.Cu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class bu{constructor(t,e,n,s,r,i,o,a,u){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=u}static fromInitialDocuments(t,e,n,s,r){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new bu(t,e,Eu.emptySet(e),i,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ki(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Cu{constructor(){this.Nu=void 0,this.listeners=[]}}class Su{constructor(){this.queries=new Fi((t=>xi(t)),ki),this.onlineState="Unknown",this.ku=new Set}}async function Au(t,e){const n=Vs(t),s=e.query;let r=!1,i=n.queries.get(s);if(i||(r=!0,i=new Cu),r)try{i.Nu=await n.onListen(s)}catch(t){const n=wu(t,`Initialization of query '${Ri(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,i),i.listeners.push(e),e.Mu(n.onlineState),i.Nu&&e.$u(i.Nu)&&Nu(n)}async function Iu(t,e){const n=Vs(t),s=e.query;let r=!1;const i=n.queries.get(s);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),r=0===i.listeners.length)}if(r)return n.queries.delete(s),n.onUnlisten(s)}function _u(t,e){const n=Vs(t);let s=!1;for(const t of e){const e=t.query,r=n.queries.get(e);if(r){for(const e of r.listeners)e.$u(t)&&(s=!0);r.Nu=t}}s&&Nu(n)}function Du(t,e,n){const s=Vs(t),r=s.queries.get(e);if(r)for(const t of r.listeners)t.onError(n);s.queries.delete(e)}function Nu(t){t.ku.forEach((t=>{t.next()}))}class ku{constructor(t,e,n){this.query=t,this.Ou=e,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new bu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Fu?this.Lu(t)&&(this.Ou.next(t),e=!0):this.qu(t,this.onlineState)&&(this.Uu(t),e=!0),this.Bu=t,e}onError(t){this.Ou.error(t)}Mu(t){this.onlineState=t;let e=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,t)&&(this.Uu(this.Bu),e=!0),e}qu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Ku||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Lu(t){if(t.docChanges.length>0)return!0;const e=this.Bu&&this.Bu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Uu(t){t=bu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Fu=!0,this.Ou.next(t)}}class xu{constructor(t){this.key=t}}class Ru{constructor(t){this.key=t}}class Ou{constructor(t,e){this.query=t,this.Yu=e,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=Gi(),this.mutatedKeys=Gi(),this.tc=Li(t),this.ec=new Eu(this.tc)}get nc(){return this.Yu}sc(t,e){const n=e?e.ic:new Tu,s=e?e.ec:this.ec;let r=e?e.mutatedKeys:this.mutatedKeys,i=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,u="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const c=s.get(t),h=Oi(this.query,e)?e:null,l=!!c&&this.mutatedKeys.has(c.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;c&&h?c.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.rc(c,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.tc(h,a)>0||u&&this.tc(h,u)<0)&&(o=!0)):!c&&h?(n.track({type:0,doc:h}),f=!0):c&&!h&&(n.track({type:1,doc:c}),f=!0,(a||u)&&(o=!0)),f&&(h?(i=i.add(h),r=d?r.add(t):r.delete(t)):(i=i.delete(t),r=r.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),r=r.delete(t.key),n.track({type:1,doc:t})}return{ec:i,ic:n,zi:o,mutatedKeys:r}}rc(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.ec;this.ec=t.ec,this.mutatedKeys=t.mutatedKeys;const r=t.ic.xu();r.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Fs()}};return n(t)-n(e)}(t.type,e.type)||this.tc(t.doc,e.doc))),this.oc(n);const i=e?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==r.length||a?{snapshot:new bu(this.query,t.ec,s,r,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:i}:{cc:i}}Mu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ec:this.ec,ic:new Tu,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(t){return!this.Yu.has(t)&&!!this.ec.has(t)&&!this.ec.get(t).hasLocalMutations}oc(t){t&&(t.addedDocuments.forEach((t=>this.Yu=this.Yu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Yu=this.Yu.delete(t))),this.current=t.current)}uc(){if(!this.current)return[];const t=this.Zu;this.Zu=Gi(),this.ec.forEach((t=>{this.ac(t.key)&&(this.Zu=this.Zu.add(t.key))}));const e=[];return t.forEach((t=>{this.Zu.has(t)||e.push(new Ru(t))})),this.Zu.forEach((n=>{t.has(n)||e.push(new xu(n))})),e}hc(t){this.Yu=t.ir,this.Zu=Gi();const e=this.sc(t.documents);return this.applyChanges(e,!0)}lc(){return bu.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Lu{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Mu{constructor(t){this.key=t,this.fc=!1}}class Fu{constructor(t,e,n,s,r,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.dc={},this.wc=new Fi((t=>xi(t)),ki),this._c=new Map,this.mc=new Set,this.gc=new vr(ir.comparator),this.yc=new Map,this.Ic=new ba,this.Tc={},this.Ec=new Map,this.Ac=ma.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function Pu(t,e){const n=function(t){const e=Vs(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Uu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Wu.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=qu.bind(null,e),e.dc.nu=_u.bind(null,e.eventManager),e.dc.Pc=Du.bind(null,e.eventManager),e}(t);let s,r;const i=n.wc.get(e);if(i)s=i.targetId,n.sharedClientState.addLocalQueryTarget(s),r=i.view.lc();else{const t=await function(t,e){const n=Vs(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.Bs.getTargetData(t,e).next((r=>r?(s=r,lr.resolve(s)):n.Bs.allocateTargetId(t).next((r=>(s=new ca(e,r,"TargetPurposeListen",t.currentSequenceNumber),n.Bs.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.Ji.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(t.targetId,t),n.Yi.set(e,t.targetId)),t}))}(n.localStore,Di(e)),i=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,r=await async function(t,e,n,s,r){t.Rc=(e,n,s)=>async function(t,e,n,s){let r=e.view.sc(n);r.zi&&(r=await Pa(t.localStore,e.query,!1).then((({documents:t})=>e.view.sc(t,r))));const i=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(r,t.isPrimaryClient,i);return Ku(t,e.targetId,o.cc),o.snapshot}(t,e,n,s);const i=await Pa(t.localStore,e,!0),o=new Ou(e,i.ir),a=o.sc(i.documents),u=Oo.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState,r),c=o.applyChanges(a,t.isPrimaryClient,u);Ku(t,n,c.cc);const h=new Lu(e,n,o);return t.wc.set(e,h),t._c.has(n)?t._c.get(n).push(e):t._c.set(n,[e]),c.snapshot}(n,e,s,"current"===i,t.resumeToken),n.isPrimaryClient&&ru(n.remoteStore,t)}return r}async function Vu(t,e){const n=Vs(t),s=n.wc.get(e),r=n._c.get(s.targetId);if(r.length>1)return n._c.set(s.targetId,r.filter((t=>!ki(t,e)))),void n.wc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Fa(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),iu(n.remoteStore,s.targetId),ju(n,s.targetId)})).catch(hr)):(ju(n,s.targetId),await Fa(n.localStore,s.targetId,!0))}async function Uu(t,e){const n=Vs(t);try{const t=await function(t,e){const n=Vs(t),s=e.snapshotVersion;let r=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.Zi.newChangeBuffer({trackRemovals:!0});r=n.Ji;const o=[];e.targetChanges.forEach(((i,a)=>{const u=r.get(a);if(!u)return;o.push(n.Bs.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(t,i.addedDocuments,a))));let c=u.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?c=c.withResumeToken(Ar.EMPTY_BYTE_STRING,tr.min()).withLastLimboFreeSnapshotVersion(tr.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,s)),r=r.insert(a,c),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(u,c,i)&&o.push(n.Bs.updateTargetData(t,c))}));let a=Vi(),u=Gi();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(function(t,e,n){let s=Gi(),r=Gi();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=Vi();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),i.isNoDocument()&&i.version.isEqual(tr.min())?(e.removeEntry(n,i.readTime),s=s.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),s=s.insert(n,i)):Rs("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{nr:s,sr:r}}))}(t,i,e.documentUpdates).next((t=>{a=t.nr,u=t.sr}))),!s.isEqual(tr.min())){const e=n.Bs.getLastRemoteSnapshotVersion(t).next((e=>n.Bs.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return lr.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,u))).next((()=>a))})).then((t=>(n.Ji=r,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.yc.get(e);s&&(Ps(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.fc=!0:t.modifiedDocuments.size>0?Ps(s.fc):t.removedDocuments.size>0&&(Ps(s.fc),s.fc=!1))})),await Qu(n,t,e)}catch(t){await hr(t)}}function Bu(t,e,n){const s=Vs(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.wc.forEach(((n,s)=>{const r=s.view.Mu(e);r.snapshot&&t.push(r.snapshot)})),function(t,e){const n=Vs(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Mu(e)&&(s=!0)})),s&&Nu(n)}(s.eventManager,e),t.length&&s.dc.nu(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function qu(t,e,n){const s=Vs(t);s.sharedClientState.updateQueryState(e,"rejected",n);const r=s.yc.get(e),i=r&&r.key;if(i){let t=new vr(ir.comparator);t=t.insert(i,Yr.newNoDocument(i,tr.min()));const n=Gi().add(i),r=new Ro(tr.min(),new Map,new vr(Ys),t,n);await Uu(s,r),s.gc=s.gc.remove(i),s.yc.delete(e),Gu(s)}else await Fa(s.localStore,e,!1).then((()=>ju(s,e,n))).catch(hr)}function ju(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t._c.get(e))t.wc.delete(s),n&&t.dc.Pc(s,n);t._c.delete(e),t.isPrimaryClient&&t.Ic.Is(e).forEach((e=>{t.Ic.containsKey(e)||zu(t,e)}))}function zu(t,e){t.mc.delete(e.path.canonicalString());const n=t.gc.get(e);null!==n&&(iu(t.remoteStore,n),t.gc=t.gc.remove(e),t.yc.delete(n),Gu(t))}function Ku(t,e,n){for(const s of n)s instanceof xu?(t.Ic.addReference(s.key,e),$u(t,s)):s instanceof Ru?(Rs("SyncEngine","Document no longer in limbo: "+s.key),t.Ic.removeReference(s.key,e),t.Ic.containsKey(s.key)||zu(t,s.key)):Fs()}function $u(t,e){const n=e.key,s=n.path.canonicalString();t.gc.get(n)||t.mc.has(s)||(Rs("SyncEngine","New document in limbo: "+n),t.mc.add(s),Gu(t))}function Gu(t){for(;t.mc.size>0&&t.gc.size<t.maxConcurrentLimboResolutions;){const e=t.mc.values().next().value;t.mc.delete(e);const n=new ir(nr.fromString(e)),s=t.Ac.next();t.yc.set(s,new Mu(n)),t.gc=t.gc.insert(n,s),ru(t.remoteStore,new ca(Di(Ai(n.path)),s,"TargetPurposeLimboResolution",fr.ct))}}async function Qu(t,e,n){const s=Vs(t),r=[],i=[],o=[];s.wc.isEmpty()||(s.wc.forEach(((t,a)=>{o.push(s.Rc(a,e,n).then((t=>{if((t||n)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);const e=xa.Li(a.targetId,t);i.push(e)}})))})),await Promise.all(o),s.dc.nu(r),await async function(t,e){const n=Vs(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>lr.forEach(e,(e=>lr.forEach(e.Fi,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>lr.forEach(e.Bi,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!dr(t))throw t;Rs("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ji.get(e),s=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(s);n.Ji=n.Ji.insert(e,r)}}}(s.localStore,i))}async function Hu(t,e){const n=Vs(t);if(!n.currentUser.isEqual(e)){Rs("SyncEngine","User change. New user:",e.toKey());const t=await La(n.localStore,e);n.currentUser=e,function(t){t.Ec.forEach((t=>{t.forEach((t=>{t.reject(new Bs(Us.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ec.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Qu(n,t.er)}}function Wu(t,e){const n=Vs(t),s=n.yc.get(e);if(s&&s.fc)return Gi().add(s.key);{let t=Gi();const s=n._c.get(e);if(!s)return t;for(const e of s){const s=n.wc.get(e);t=t.unionWith(s.view.nc)}return t}}class Xu{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Wa(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,s){return new Oa(t,e,n,s)}(this.persistence,new Ra,t.initialUser,this.serializer)}createPersistence(t){return new Da(ka.zs,this.serializer)}createSharedClientState(t){return new Ua}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Yu{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Bu(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Hu.bind(null,this.syncEngine),await async function(t,e){const n=Vs(t);e?(n.vu.delete(2),await nu(n)):e||(n.vu.add(2),await su(n),n.bu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Su}createDatastore(t){const e=Wa(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new Qa(s));var s;return function(t,e,n,s){return new Za(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,r=t=>Bu(this.syncEngine,t,0),i=qa.D()?new qa:new Ba,new eu(e,n,s,r,i);var e,n,s,r,i}createSyncEngine(t,e){return function(t,e,n,s,r,i,o){const a=new Fu(t,e,n,s,r,i);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Vs(t);Rs("RemoteStore","RemoteStore shutting down."),e.vu.add(5),await su(e),e.Pu.shutdown(),e.bu.set("Unknown")}(this.remoteStore)}}class Ju{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Sc(this.observer.next,t)}error(t){this.observer.error?this.Sc(this.observer.error,t):Os("Uncaught Error in snapshot listener:",t.toString())}Dc(){this.muted=!0}Sc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Zu{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=Ds.UNAUTHENTICATED,this.clientId=Xs.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Rs("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Rs("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Bs(Us.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new qs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=wu(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function tc(t,e){t.asyncQueue.verifyOperationInProgress(),Rs("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await La(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function ec(t,e){t.asyncQueue.verifyOperationInProgress();const n=await nc(t);Rs("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>mu(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>mu(e.remoteStore,n))),t._onlineComponents=e}async function nc(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Rs("FirestoreClient","Using user provided OfflineComponentProvider");try{await tc(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Us.FAILED_PRECONDITION||t.code===Us.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Ls("Error using user provided cache. Falling back to memory cache: "+n),await tc(t,new Xu)}}else Rs("FirestoreClient","Using default OfflineComponentProvider"),await tc(t,new Xu);return t._offlineComponents}function sc(t){return nc(t).then((t=>t.localStore))}async function rc(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Rs("FirestoreClient","Using user provided OnlineComponentProvider"),await ec(t,t._uninitializedComponentsProvider._online)):(Rs("FirestoreClient","Using default OnlineComponentProvider"),await ec(t,new Yu))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=Pu.bind(null,e.syncEngine),n.onUnlisten=Vu.bind(null,e.syncEngine),n}function ic(t,e,n={}){const s=new qs;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,r){const i=new Ju({next:i=>{e.enqueueAndForget((()=>Iu(t,o)));const a=i.docs.has(n);!a&&i.fromCache?r.reject(new Bs(Us.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&s&&"server"===s.source?r.reject(new Bs(Us.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(i)},error:t=>r.reject(t)}),o=new ku(Ai(n.path),i,{includeMetadataChanges:!0,Ku:!0});return Au(t,o)}(await rc(t),t.asyncQueue,e,n,s))),s.promise}function oc(t,e,n={}){const s=new qs;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,r){const i=new Ju({next:n=>{e.enqueueAndForget((()=>Iu(t,o))),n.fromCache&&"server"===s.source?r.reject(new Bs(Us.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:t=>r.reject(t)}),o=new ku(n,i,{includeMetadataChanges:!0,Ku:!0});return Au(t,o)}(await rc(t),t.asyncQueue,e,n,s))),s.promise}function ac(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const uc=new Map;function cc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Bs(Us.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Fs()}(t);throw new Bs(Us.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class hc{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Bs(Us.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.cache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Bs(Us.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,s){if(!0===e&&!0===s)throw new Bs(Us.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ac(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Bs(Us.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Bs(Us.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Bs(Us.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(e=this.experimentalLongPollingOptions,n=t.experimentalLongPollingOptions,e.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams;var e,n}}class lc{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Bs(Us.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Bs(Us.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hc(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new zs;switch(t.type){case"firstParty":return new Gs(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Bs(Us.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=uc.get(t);e&&(Rs("ComponentProvider","Removing Datastore"),uc.delete(t),e.terminate())}(this),Promise.resolve()}}class dc{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new dc(this.firestore,t,this._key)}}class fc{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new fc(this.firestore,t,this._query)}}class gc extends fc{constructor(t,e,n){super(t,e,Ai(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new dc(this.firestore,null,new ir(t))}withConverter(t){return new gc(this.firestore,t,this._path)}}class pc{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Xa(this,"async_queue_retry"),this.Xc=()=>{const t=Ha();t&&Rs("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const t=Ha();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Zc(),this.ta(t)}enterRestrictedMode(t){if(!this.jc){this.jc=!0,this.Jc=t||!1;const e=Ha();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xc)}}enqueue(t){if(this.Zc(),this.jc)return new Promise((()=>{}));const e=new qs;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Qc.push(t),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(t){if(!dr(t))throw t;Rs("AsyncQueue","Operation failed with retryable error: "+t)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(t){const e=this.Gc.then((()=>(this.Hc=!0,t().catch((t=>{this.Wc=t,this.Hc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Os("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Hc=!1,t))))));return this.Gc=e,e}enqueueAfterDelay(t,e,n){this.Zc(),this.Yc.indexOf(t)>-1&&(e=0);const s=vu.createAndSchedule(this,t,e,n,(t=>this.na(t)));return this.zc.push(s),s}Zc(){this.Wc&&Fs()}verifyOperationInProgress(){}async sa(){let t;do{t=this.Gc,await t}while(t!==this.Gc)}ia(t){for(const e of this.zc)if(e.timerId===t)return!0;return!1}ra(t){return this.sa().then((()=>{this.zc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.zc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.sa()}))}oa(t){this.Yc.push(t)}na(t){const e=this.zc.indexOf(t);this.zc.splice(e,1)}}function mc(t){return function(t){if("object"!=typeof t||null===t)return!1;const e=t;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(t)}class yc extends lc{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new pc,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||wc(this),this._firestoreClient.terminate()}}function vc(t){return t._firestoreClient||wc(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function wc(t){var e,n,s;const r=t._freezeSettings(),i=function(t,e,n,s){return new Or(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,ac(s.experimentalLongPollingOptions),s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new Zu(t._authCredentials,t._appCheckCredentials,t._queue,i),(null===(n=r.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(s=r.cache)||void 0===s?void 0:s._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.cache.kind,_offline:r.cache._offlineComponentProvider,_online:r.cache._onlineComponentProvider})}class Ec{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ec(Ar.fromBase64String(t))}catch(t){throw new Bs(Us.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Ec(Ar.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Tc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Bs(Us.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rr(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class bc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Bs(Us.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Bs(Us.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Ys(this._lat,t._lat)||Ys(this._long,t._long)}}const Cc=new RegExp("[~\\*/\\[\\]]");function Sc(t,e,n,s,r){const i=s&&!s.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${s}`),o&&(u+=` in document ${r}`),u+=")"),new Bs(Us.INVALID_ARGUMENT,a+t+u)}class Ac{constructor(t,e,n,s,r){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new dc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Ic(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(_c("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Ic extends Ac{data(){return super.data()}}function _c(t,e){return"string"==typeof e?function(t,e,n){if(e.search(Cc)>=0)throw Sc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Tc(...e.split("."))._internalPath}catch(s){throw Sc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof Tc?e._internalPath:e._delegate._internalPath}function Dc(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Bs(Us.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Nc{convertValue(t,e="none"){switch(Fr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Dr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Nr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Fs()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return yr(t,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new bc(Dr(t.latitude),Dr(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=xr(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Rr(t));default:return null}}convertTimestamp(t){const e=_r(t);return new Zs(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=nr.fromString(t);Ps(ua(n));const s=new Lr(n.get(1),n.get(3)),r=new ir(n.popFirst(5));return s.isEqual(e)||Os(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}class kc{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class xc extends Ac{constructor(t,e,n,s,r,i){super(t,e,n,s,i),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Rc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(_c("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Rc extends xc{data(t={}){return super.data(t)}}class Oc{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new kc(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Rc(this._firestore,this._userDataWriter,n.key,n,new kc(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Bs(Us.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const s=new Rc(t._firestore,t._userDataWriter,n.doc.key,n.doc,new kc(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Rc(t._firestore,t._userDataWriter,e.doc.key,e.doc,new kc(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let r=-1,i=-1;return 0!==e.type&&(r=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:Lc(e.type),doc:s,oldIndex:r,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Lc(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Fs()}}function Mc(t){t=cc(t,dc);const e=cc(t.firestore,yc);return ic(vc(e),t._key).then((n=>zc(e,t,n)))}class Fc extends Nc{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ec(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new dc(this.firestore,null,e)}}function Pc(t){t=cc(t,dc);const e=cc(t.firestore,yc),n=vc(e),s=new Fc(e);return function(t,e){const n=new qs;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await function(t,e){const n=Vs(t);return n.persistence.runTransaction("read document","readonly",(t=>n.localDocuments.getDocument(t,e)))}(t,e);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new Bs(Us.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=wu(t,`Failed to get document '${e} from cache`);n.reject(s)}}(await sc(t),e,n))),n.promise}(n,t._key).then((n=>new xc(e,s,t._key,n,new kc(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Vc(t){t=cc(t,dc);const e=cc(t.firestore,yc);return ic(vc(e),t._key,{source:"server"}).then((n=>zc(e,t,n)))}function Uc(t){t=cc(t,fc);const e=cc(t.firestore,yc),n=vc(e),s=new Fc(e);return Dc(t._query),oc(n,t._query).then((n=>new Oc(e,s,t,n)))}function Bc(t){t=cc(t,fc);const e=cc(t.firestore,yc),n=vc(e),s=new Fc(e);return function(t,e){const n=new qs;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await Pa(t,e,!0),r=new Ou(e,s.ir),i=r.sc(s.documents),o=r.applyChanges(i,!1);n.resolve(o.snapshot)}catch(t){const s=wu(t,`Failed to execute query '${e} against cache`);n.reject(s)}}(await sc(t),e,n))),n.promise}(n,t._query).then((n=>new Oc(e,s,t,n)))}function qc(t){t=cc(t,fc);const e=cc(t.firestore,yc),n=vc(e),s=new Fc(e);return oc(n,t._query,{source:"server"}).then((n=>new Oc(e,s,t,n)))}function jc(t,...e){var n,s,r;t=(0,a.Ku)(t);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||mc(e[o])||(i=e[o],o++);const u={includeMetadataChanges:i.includeMetadataChanges};if(mc(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(r=t.complete)||void 0===r?void 0:r.bind(t)}let c,h,l;if(t instanceof dc)h=cc(t.firestore,yc),l=Ai(t._key.path),c={next:n=>{e[o]&&e[o](zc(h,t,n))},error:e[o+1],complete:e[o+2]};else{const n=cc(t,fc);h=cc(n.firestore,yc),l=n._query;const s=new Fc(h);c={next:t=>{e[o]&&e[o](new Oc(h,s,n,t))},error:e[o+1],complete:e[o+2]},Dc(t._query)}return function(t,e,n,s){const r=new Ju(s),i=new ku(e,r,n);return t.asyncQueue.enqueueAndForget((async()=>Au(await rc(t),i))),()=>{r.Dc(),t.asyncQueue.enqueueAndForget((async()=>Iu(await rc(t),i)))}}(vc(h),l,u,c)}function zc(t,e,n){const s=n.docs.get(e._key),r=new Fc(t);return new xc(t,r,e._key,s,new kc(n.hasPendingWrites,n.fromCache),e.converter)}!function(t,e=!0){!function(t){Ns=t}(r.MF),(0,r.om)(new i.uA("firestore",((t,{instanceIdentifier:n,options:s})=>{const r=t.getProvider("app").getImmediate(),i=new yc(new Ks(t.getProvider("auth-internal")),new Hs(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Bs(Us.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Lr(t.options.projectId,e)}(r,n),r);return s=Object.assign({useFetchStreams:e},s),i._setSettings(s),i}),"PUBLIC").setMultipleInstances(!0)),(0,r.KO)(_s,"3.13.0",t),(0,r.KO)(_s,"3.13.0","esm2017")}();var Kc=n(6540);function $c(t,e,n,s){return new(n||(n=Promise))((function(r,i){function o(t){try{u(s.next(t))}catch(t){i(t)}}function a(t){try{u(s.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((s=s.apply(t,e||[])).next())}))}function Gc(t,e){var n,s,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(r=2&i[0]?s.return:i[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,i[1])).done)return r;switch(s=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,s=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],s=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var Qc=function(){return Qc=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Qc.apply(this,arguments)},Hc=function(t){return{loading:null==t,value:t}},Wc=function(t){var e=t?t():void 0,n=(0,Kc.useReducer)((function(t,e){switch(e.type){case"error":return Qc(Qc({},t),{error:e.error,loading:!1,value:void 0});case"reset":return Hc(e.defaultValue);case"value":return Qc(Qc({},t),{error:void 0,loading:!1,value:e.value});default:return t}}),Hc(e)),s=n[0],r=n[1],i=(0,Kc.useCallback)((function(){var e=t?t():void 0;r({type:"reset",defaultValue:e})}),[t]),o=(0,Kc.useCallback)((function(t){r({type:"error",error:t})}),[]),a=(0,Kc.useCallback)((function(t){r({type:"value",value:t})}),[]);return(0,Kc.useMemo)((function(){return{error:s.error,loading:s.loading,reset:i,setError:o,setValue:a,value:s.value}}),[s.error,s.loading,i,o,a,s.value])},Xc=function(t,e,n){var s=(0,Kc.useRef)(t);return(0,Kc.useEffect)((function(){e(t,s.current)||(s.current=t,n&&n())})),s},Yc=function(){var t=(0,Kc.useState)(!0),e=t[0],n=t[1];return(0,Kc.useEffect)((function(){return function(){n(!1)}}),[]),e},Jc=function(t,e){var n,s,r=!t&&!e,i=!!t&&!!e&&(n=t,s=e,n=(0,a.Ku)(n),s=(0,a.Ku)(s),(n instanceof dc||n instanceof gc)&&(s instanceof dc||s instanceof gc)&&n.firestore===s.firestore&&n.path===s.path&&n.converter===s.converter);return r||i},Zc=function(t,e){return Xc(t,Jc,e)},th=function(t,e){var n,s,r=!t&&!e,i=!!t&&!!e&&(n=t,s=e,n=(0,a.Ku)(n),s=(0,a.Ku)(s),n instanceof fc&&s instanceof fc&&n.firestore===s.firestore&&ki(n._query,s._query)&&n.converter===s.converter);return r||i},eh=function(t,e){return Xc(t,th,e)},nh=function(t,e){var n=Wc(),s=n.error,r=n.loading,i=n.reset,o=n.setError,a=n.setValue,u=n.value,c=eh(t,i);return(0,Kc.useEffect)((function(){if(c.current){var t=(null==e?void 0:e.snapshotListenOptions)?jc(c.current,e.snapshotListenOptions,a,o):jc(c.current,a,o);return function(){t()}}a(void 0)}),[c.current]),[u,r,s]},sh=function(t,e){var n=Wc(),s=n.error,r=n.loading,i=n.reset,o=n.setError,a=n.setValue,u=n.value,c=Yc(),h=eh(t,i),l=(0,Kc.useCallback)((function(t,e){return $c(void 0,void 0,void 0,(function(){var n,s,r;return Gc(this,(function(i){switch(i.label){case 0:if(!t)return a(void 0),[2];n=ah(null==e?void 0:e.getOptions),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n(t)];case 2:return s=i.sent(),c&&a(s),[3,4];case 3:return r=i.sent(),c&&o(r),[3,4];case 4:return[2]}}))}))}),[]),d=(0,Kc.useCallback)((function(){return l(h.current,e)}),[l,h.current]);return(0,Kc.useEffect)((function(){l(h.current,e)}),[h.current]),[u,r,s,d]},rh=function(t,e){var n=nh(t,e),s=n[0],r=n[1],i=n[2];return[oh(s,null==e?void 0:e.snapshotOptions,null==e?void 0:e.initialValue),r,i,s]},ih=function(t,e){var n=sh(t,e),s=n[0],r=n[1],i=n[2],o=n[3];return[oh(s,null==e?void 0:e.snapshotOptions,null==e?void 0:e.initialValue),r,i,s,o]},oh=function(t,e,n){return(0,Kc.useMemo)((function(){var s;return null!==(s=null==t?void 0:t.docs.map((function(t){return t.data(e)})))&&void 0!==s?s:n}),[t,e])},ah=function(t){switch((void 0===t?{source:"default"}:t).source){default:case"default":return Uc;case"cache":return Bc;case"server":return qc}},uh=function(t,e){var n=Wc(),s=n.error,r=n.loading,i=n.reset,o=n.setError,a=n.setValue,u=n.value,c=Zc(t,i);return(0,Kc.useEffect)((function(){if(c.current){var t=(null==e?void 0:e.snapshotListenOptions)?jc(c.current,e.snapshotListenOptions,a,o):jc(c.current,a,o);return function(){t()}}a(void 0)}),[c.current]),[u,r,s]},ch=function(t,e){var n=Wc(),s=n.error,r=n.loading,i=n.reset,o=n.setError,a=n.setValue,u=n.value,c=Yc(),h=Zc(t,i),l=(0,Kc.useCallback)((function(t,e){return $c(void 0,void 0,void 0,(function(){var n,s,r;return Gc(this,(function(i){switch(i.label){case 0:if(!t)return a(void 0),[2];n=dh(null==e?void 0:e.getOptions),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n(t)];case 2:return s=i.sent(),c&&a(s),[3,4];case 3:return r=i.sent(),c&&o(r),[3,4];case 4:return[2]}}))}))}),[]),d=(0,Kc.useCallback)((function(){return l(h.current,e)}),[l,h.current]);return(0,Kc.useEffect)((function(){h.current?l(h.current,e):a(void 0)}),[h.current]),[u,r,s,d]},hh=function(t,e){var n=uh(t,e),s=n[0],r=n[1],i=n[2];return[fh(s,null==e?void 0:e.snapshotOptions,null==e?void 0:e.initialValue),r,i,s]},lh=function(t,e){var n=ch(t,e),s=n[0],r=n[1],i=n[2],o=n[3];return[fh(s,null==e?void 0:e.snapshotOptions,null==e?void 0:e.initialValue),r,i,s,o]},dh=function(t){switch((void 0===t?{source:"default"}:t).source){default:case"default":return Mc;case"cache":return Pc;case"server":return Vc}},fh=function(t,e,n){return(0,Kc.useMemo)((function(){var s;return null!==(s=null==t?void 0:t.data(e))&&void 0!==s?s:n}),[t,e,n])}},6540:(t,e,n)=>{t.exports=n(5287)}}]);