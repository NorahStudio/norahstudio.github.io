"use strict";(self.webpackChunkenjoy_life3000=self.webpackChunkenjoy_life3000||[]).push([[640],{8640:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.installHomemadeServiceWorker=void 0;var i=n(4148),a=n(3980),c=(Math.floor(Date.now()/100)%1e5+"").padStart(5,"0");function s(e,t,n,a){return r(this,void 0,void 0,(function(){var r,s,l;return o(this,(function(o){switch(o.label){case 0:if(a.classList.toggle("hidden"),!n.classList.contains("hidden")){for(t.textContent="Show DB log",n.classList.add("hidden");n.hasChildNodes();)n.removeChild(i.TypeChecker.checkExists(n.firstChild));return[2]}return t.textContent="Hide DB log",[4,e.getAllLogViaCursor()];case 1:r=o.sent(),o.label=2;case 2:return r?(s=r.value,l=document.createElement("div"),s.startsWith("[P ".concat(c,"]"))||l.classList.add("darkcyan"),l.textContent=s,n.appendChild(l),[4,r.continue()]):[3,4];case 3:return r=o.sent(),[3,2];case 4:return n.classList.remove("hidden"),[2]}}))}))}function l(e){return i.TypeChecker.checkExists(document.getElementById(e))}document.title="[".concat(c,"] ")+document.title,t.installHomemadeServiceWorker=function(e){return r(this,void 0,void 0,(function(){function t(t){var n="[P ".concat(c,"][").concat((new Date).toLocaleString(),"] ").concat(t);console.log(n),u.writeLog(n),e&&function(e){var t=document.createElement("div");t.textContent=e,l("page-log").appendChild(t)}(n)}function n(){null==d||d.addEventListener("statechange",(function(e){console.log(e),t("activeServiceWorker.onstatechange - activeServiceWorker.state: ".concat(null==d?void 0:d.state))}))}var u,d,f,h,v,p,g=this;return o(this,(function(c){switch(c.label){case 0:u=new a.ServiceWorkerPlaygroundStore,t("Run index.js..."),f=new URLSearchParams(window.location.search),h=f.get("v"),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,navigator.serviceWorker.register("/homemade-serviceworker/index.js".concat(h?"?v="+h:""),{scope:"/"})];case 2:return v=c.sent(),t("Service worker registration succeeded"),d=function(e){var t=e.active||e.waiting||e.installing;if(!t)throw new Error("No worker found");return t}(v),navigator.serviceWorker.addEventListener("controllerchange",(function(){navigator.serviceWorker.controller!==d?(t("ServiceWorkerContainer.oncontrollerchange - new controller"),d=navigator.serviceWorker.controller,n()):t("ServiceWorkerContainer.oncontrollerchange - same controller")})),n(),[3,4];case 3:return p=c.sent(),console.error(p),t("[ERROR] ".concat(p)),[3,4];case 4:return e&&function(e){var t=this,n=e.sendMessageToSw,i=e.sendFetchRequest,a=e.store,c=e.log;l("message").addEventListener("click",(function(){return n("Hello, I am from postMessage")})),l("fetch").addEventListener("click",(function(){return i()}));var u=l("show-db-log");u.addEventListener("click",(function(){return r(t,void 0,void 0,(function(){return o(this,(function(e){return[2,s(a,u,l("db-log"),l("page-log"))]}))}))})),l("clear-db-log").addEventListener("click",(function(){return r(t,void 0,void 0,(function(){return o(this,(function(e){return a.clearLog(),[2]}))}))}));var d=l("current-time"),f=l("watchdog"),h=l("sw-state"),v=!1,p=function(){return r(t,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:return[4,a.readTimestamp()];case 1:return(e=r.sent())?(t=e,Date.now()-t>4e3?(v||c("SW is terminated (Last seen: ".concat(new Date(t).toLocaleString(),")")),v=!0,f.classList.add("orange"),f.classList.remove("green")):(v=!1,f.classList.remove("orange"),f.classList.add("green")),n=navigator.serviceWorker.controller,d.textContent="".concat((new Date).toLocaleString()),f.textContent="".concat(new Date(t).toLocaleString()),n?(h.textContent=n.state,h.classList.add("green")):(h.textContent="N/A",h.classList.remove("green")),requestAnimationFrame(p),[2]):(console.error("Timestamp is Unavailable!!"),requestAnimationFrame(p),[2])}}))}))};requestAnimationFrame(p)}({sendMessageToSw:function(e){i.TypeChecker.checkExists(d).postMessage(e),t("Send message: ".concat(e))},sendFetchRequest:function(){return r(g,void 0,void 0,(function(){var e,n,r,i,a;return o(this,(function(o){switch(o.label){case 0:return[4,fetch("./food_data")];case 1:return e=o.sent(),n=t,r="Fetch Data: ".concat,a=(i=JSON).stringify,[4,e.json()];case 2:return n.apply(void 0,[r.apply("Fetch Data: ",[a.apply(i,[o.sent()])])]),[2]}}))}))},store:u,log:t}),window.addEventListener("beforeunload",(function(){return t("Close!")})),[2]}}))}))}},3980:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceWorkerPlaygroundStore=void 0;var i=n(931),a=function(){function e(){this.idbPromise=i.IdbDatabase.open({name:"sw-playground",version:1,onUpgradeNeeded:function(e){var t=e.db,n=e.event;null!=n.newVersion?0===n.oldVersion&&(t.objectStoreNames.contains("timestamp")?console.warn("ServiceWorkerPlaygroundStore has 'timestamp' objectstore already"):t.createObjectStore("timestamp"),t.objectStoreNames.contains("log")?console.warn("ServiceWorkerPlaygroundStore has 'log' objectstore already"):t.createObjectStore("log",{autoIncrement:!0})):console.warn("null newVersion")},onBlocked:function(){console.warn("Opening db is blocked")}})}return e.prototype.updateTimestamp=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,this.idbPromise];case 1:return[4,(e=t.sent().transaction("timestamp","readwrite")).objectStore("timestamp").put(Date.now(),"timestamp")];case 2:return t.sent(),[4,e.waitUntilComplete()];case 3:return t.sent(),[2]}}))}))},e.prototype.readTimestamp=function(){return r(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return[4,this.idbPromise];case 1:return[4,(e=n.sent().transaction("timestamp","readonly")).objectStore("timestamp").get("timestamp")];case 2:return t=n.sent(),[4,e.waitUntilComplete()];case 3:return n.sent(),[2,t]}}))}))},e.prototype.writeLog=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.idbPromise];case 1:return[4,(t=n.sent().transaction("log","readwrite")).objectStore("log").put(e)];case 2:return n.sent(),[4,t.waitUntilComplete()];case 3:return n.sent(),[2]}}))}))},e.prototype.getAllLog=function(){return r(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return[4,this.idbPromise];case 1:return[4,(e=n.sent().transaction("log","readonly")).objectStore("log").getAll()];case 2:return t=n.sent(),[4,e.waitUntilComplete()];case 3:return n.sent(),[2,t]}}))}))},e.prototype.getAllLogViaCursor=function(){return r(this,void 0,void 0,(function(){var e,t,n,i=this;return o(this,(function(a){switch(a.label){case 0:return[4,this.idbPromise];case 1:return[4,(e=a.sent().transaction("log","readonly")).objectStore("log").openCursor()];case 2:return null!=(t=a.sent())?[3,4]:[4,e.waitUntilComplete()];case 3:return a.sent(),[2];case 4:return n=t,[2,{get value(){if("string"!=typeof n.value)throw new Error("Unknown log type");return n.value},continue:function(){return r(i,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return[4,n.continue()];case 1:return null!=(t=r.sent())?[3,3]:[4,e.waitUntilComplete()];case 2:return r.sent(),[2];case 3:return[2,t]}}))}))}}]}}))}))},e.prototype.clearLog=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,this.idbPromise];case 1:return[4,(e=t.sent().transaction("log","readwrite")).objectStore("log").clear()];case 2:return t.sent(),[4,e.waitUntilComplete()];case 3:return t.sent(),[2]}}))}))},e}();t.ServiceWorkerPlaygroundStore=a},4148:function(e,t){var n=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.TypeChecker=void 0;var r=function(){function e(){}return e.checkState=function(t,r){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];if(!t)throw new Error(null==r?"invalid state":e.format.apply(e,n([r],o,!1)))},e.checkEquals=function(t,r,o){for(var i=[],a=3;a<arguments.length;a++)i[a-3]=arguments[a];if(t!==r)throw new Error(null==o?e.format("{} != {}",e.stringify(t),e.stringify(r)):e.format.apply(e,n([o],i,!1)))},e.checkExists=function(t,r){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];if(null==t)throw new Error(null==r?"argument is null":e.format.apply(e,n([r],o,!1)));return t},e.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=0;return e.replace(/\{}/g,(function(){return r<t.length?t[r++]:"{}"}))},e.stringify=function(e){if(null==e||"symbol"==typeof e)return String(e);try{return JSON.stringify(e)}catch(t){return String(e)}},e}();t.TypeChecker=r}}]);